<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lee Man FC Player Review Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- For A4 paper printing -->
    <style>
    @media print {
        @page {
            size: A4 portrait;
            margin: 1cm;
        }
        html, body {
            height: auto !important;
            overflow: visible !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            color-adjust: exact;
            margin: 0;
            background-color: white;
        }
        .no-print, .hide-for-print, .print-back-btn { 
            display: none !important; 
        }
        .page-break { 
            page-break-before: always !important; 
            break-before: page !important;
            display: block !important;
            height: 0 !important;
            clear: both !important;
        }
        #report-container { 
            width: 100% !important; 
            max-width: none !important;
            padding: 0.5cm !important;
            margin: 0 auto !important;
            box-sizing: border-box !important;
            height: auto !important;
            overflow: visible !important;
        }
        #app-container {
            display: none !important; 
        }
        #print-container {
            display: block !important;
            position: static !important;
            width: 100% !important;
            height: auto !important;
            overflow: visible !important;
            background: white !important;
            z-index: auto !important;
            padding: 0 !important;
        }
        .grid-2x2 {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
        }
        
        /* Grid and flexbox settings for printing */
        .grid, .flex {
            display: block !important;
        }
        
        /* Reset container sizes */
        *, *::before, *::after {
            box-sizing: border-box !important;
        }
        
        /* Ensure headings don't get separated from their content */
        h1, h2, h3, h4, h5, h6 {
            page-break-after: avoid !important;
            break-after: avoid !important;
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* General layout fixes */
        .print-section {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        .print-section-break {
            page-break-before: always !important;
            break-before: always !important;
        }
        
        /* Explicitly allow these to break across pages */
        .print-allow-break {
            page-break-inside: auto !important;
            break-inside: auto !important;
        }
        
        /* Signature section */
        .signature-section {
            page-break-before: always !important;
            break-before: page !important;
            margin-top: 3cm !important;
        }
        .signature-line {
            width: 150px;
            height: 1px;
            background: black;
            margin: 0 auto 8px;
        }
        
        /* Force image rendering */
        img {
            display: block !important;
            max-width: 100% !important;
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
    }

    /* Screen-specific adjustments for print mode */
    .print-mode #app-container {
        display: none !important;
    }
    .print-mode #print-container {
        display: block !important;
        position: fixed !important;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        z-index: 9999;
        overflow: auto;
        padding: 20px;
    }
    /* Ensure Back to Editor button is styled */
    .print-back-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        background-color: #FFD700;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .print-mode .print-back-btn {
        display: block !important; /* Ensure visibility in print mode */
    }
    </style>
    

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFD700',
                        secondary: '#E6C200',
                        textPrimary: '#333333'
                    },
                    fontFamily: {
                        sans: ['Helvetica', 'Arial', 'sans-serif'],
                    }
                }
            },
            darkMode: 'class'
        }
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            document.documentElement.classList.toggle('dark', event.matches);
        });
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Main App Container -->
    <div id="app-container" class="container mx-auto px-4 py-6 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-primary mb-2">Lee Man FC Player Review Generator</h1>
            <p class="text-gray-600 dark:text-gray-400">Create comprehensive player review reports for your academy players</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-primary">Player Data Input</h2>
                
                <!-- Player Data Input Method Toggle -->
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Data Input Method</label>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="player-input-method" value="manual" checked class="text-primary focus:ring-primary" id="manual-player-data">
                            <span class="ml-2">Manual Input</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="player-input-method" value="file" class="text-primary focus:ring-primary" id="file-player-data">
                            <span class="ml-2">Upload File</span>
                        </label>
                    </div>
                </div>
                
                <!-- File Upload Section -->
                <div id="player-file-input" class="mb-6 space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium mb-1" for="xlsFile">Upload Player Data (XLS/XLSX)</label>
                        <input type="file" id="xlsFile" accept=".xls,.xlsx" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer" />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">XLS file should include: First Name, Last Name, Date of Birth, etc.</p>
                    </div>
                    <div id="playerSelectContainer" class="hidden">
                        <label class="block text-sm font-medium mb-1" for="playerSelect">Select Player</label>
                        <select id="playerSelect" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700">
                            <option value="">Select a player...</option>
                        </select>
                    </div>
                </div>
                
                <!-- Manual Player Data Input -->
                <div id="player-manual-input" class="mb-6 space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="manual-first-name" class="block text-sm font-medium mb-1">First Name</label>
                            <input type="text" id="manual-first-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter first name">
                        </div>
                        <div>
                            <label for="manual-last-name" class="block text-sm font-medium mb-1">Last Name</label>
                            <input type="text" id="manual-last-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter last name">
                        </div>
                    </div>
                    <div>
                        <label for="manual-dob" class="block text-sm font-medium mb-1">Date of Birth</label>
                        <input type="date" id="manual-dob" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base">
                    </div>
                    <div>
                        <label for="manual-position" class="block text-sm font-medium mb-1">Position</label>
                        <input type="text" id="manual-position" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter player position">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1" for="portraitFile">Upload Player Portrait</label>
                    <input type="file" id="portraitFile" accept="image/jpeg,image/png" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer" />
                </div>
                
                <!-- Club Logo Upload (Optional) -->
                <div class="mt-4">
                    <label class="block text-sm font-medium mb-1" for="clubLogoFile">Upload Club Logo (Optional)</label>
                    <input type="file" id="clubLogoFile" accept="image/jpeg,image/png,image/svg+xml" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer" />
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">If not provided, a default club logo will be used.</p>
                </div>

				<!-- Height Growth Data Section -->
				<div class="mb-6 mt-6">
					<div class="flex justify-between items-center">
						<h3 class="font-medium text-lg">Height Growth Data</h3>
						<button type="button" id="toggle-height-growth" class="text-sm text-primary hover:text-secondary">
							<span id="toggle-height-growth-text">Show Section</span>
						</button>
					</div>
					<div id="height-growth-section" class="mt-3 hidden">
						<div class="bg-white dark:bg-gray-700 p-4 rounded-md mb-4">
							<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
								<div>
									<label for="height-start-month" class="block text-sm font-medium mb-1">Start Month</label>
									<select id="height-start-month" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700">
										<option value="0">January</option>
										<option value="1">February</option>
										<option value="2">March</option>
										<option value="3">April</option>
										<option value="4">May</option>
										<option value="5">June</option>
										<option value="6">July</option>
										<option value="7">August</option>
										<option value="8">September</option>
										<option value="9">October</option>
										<option value="10">November</option>
										<option value="11">December</option>
									</select>
								</div>
								<div>
									<label for="height-end-month" class="block text-sm font-medium mb-1">End Month</label>
									<select id="height-end-month" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700">
										<option value="0">January</option>
										<option value="1">February</option>
										<option value="2">March</option>
										<option value="3">April</option>
										<option value="4">May</option>
										<option value="5" selected>June</option>
										<option value="6">July</option>
										<option value="7">August</option>
										<option value="8">September</option>
										<option value="9">October</option>
										<option value="10">November</option>
										<option value="11">December</option>
									</select>
								</div>
								<div>
									<label for="height-year" class="block text-sm font-medium mb-1">Year</label>
									<select id="height-year" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700">
										<!-- Years will be dynamically populated -->
									</select>
								</div>
							</div>
							<p class="mb-4 text-xs text-gray-500 dark:text-gray-400">Select the start and end months, and the year for the height tracking period.</p>
							<div id="height-growth-inputs" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
								<!-- Month inputs will be dynamically generated -->
							</div>
						</div>
					</div>
				</div>





                <!-- Attendance Data Section -->
                <div class="mb-6 mt-6">
                    <div class="flex justify-between items-center">
                        <h3 class="font-medium text-lg">Attendance Data</h3>
                        <button type="button" id="toggle-attendance" class="text-sm text-primary hover:text-secondary">
                            <span id="toggle-attendance-text">Show Section</span>
                        </button>
                    </div>
                    <div id="attendance-section" class="mt-3 hidden">
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-md mb-4">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-1">Data Input Method</label>
                                <div class="flex space-x-4">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="attendance-input-method" value="manual" checked class="text-primary focus:ring-primary" id="manual-attendance">
                                        <span class="ml-2">Manual Input</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="attendance-input-method" value="file" class="text-primary focus:ring-primary" id="file-attendance">
                                        <span class="ml-2">Upload File</span>
                                    </label>
                                </div>
                            </div>
                            <div id="attendance-file-input" class="hidden mb-4">
                                <label class="block text-sm font-medium mb-1" for="attendanceFile">Upload Attendance Data (XLS/XLSX)</label>
                                <input type="file" id="attendanceFile" accept=".xls,.xlsx" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer" />
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">File should include training and match attendance data.</p>
                            </div>
                            <div id="attendance-manual-input">
                                <div class="mb-4">
                                    <h4 class="font-medium text-md mb-2">Training Attendance</h4>
                                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm mb-1" for="total-training-sessions">Total Sessions</label>
                                            <input type="number" min="0" id="total-training-sessions" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1" for="training-sessions-attended">Sessions Attended</label>
                                            <input type="number" min="0" id="training-sessions-attended" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1" for="total-training-minutes">Total Minutes</label>
                                            <input type="number" min="0" id="total-training-minutes" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" value="0">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-medium text-md mb-2">Match Clock</h4>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm mb-1" for="total-matches">Total Matches</label>
                                            <input type="number" min="0" id="total-matches" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1" for="matches-played">Matches Played</label>
                                            <input type="number" min="0" id="matches-played" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1" for="total-match-minutes">Total Match Minutes</label>
                                            <input type="number" min="0" id="total-match-minutes" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1" for="match-minutes-played">Match Minutes Played</label>
                                            <input type="number" min="0" id="match-minutes-played" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" value="0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rating Sliders -->
                <div class="mb-6">
                    <h3 class="font-medium text-lg mb-3">Performance Ratings</h3>
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2">1. Game Intelligence</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1" for="movement-to-receive">Movement to Receive</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="movement-to-receive">
                                    <span class="ml-2 min-w-[20px] text-center" id="movement-to-receive-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="actions-to-create">Actions to Create</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="actions-to-create">
                                    <span class="ml-2 min-w-[20px] text-center" id="actions-to-create-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="actions-to-disrupt">Actions to Disrupt</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="actions-to-disrupt">
                                    <span class="ml-2 min-w-[20px] text-center" id="actions-to-disrupt-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2">2. Technical Ability</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1" for="with-balance">With Balance</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="with-balance">
                                    <span class="ml-2 min-w-[20px] text-center" id="with-balance-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="with-speed">With Speed</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="with-speed">
                                    <span class="ml-2 min-w-[20px] text-center" id="with-speed-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="execution">Execution</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="execution">
                                    <span class="ml-2 min-w-[20px] text-center" id="execution-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2">3. Physical Capacity</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1" for="speed">Speed</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="speed">
                                    <span class="ml-2 min-w-[20px] text-center" id="speed-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="aggressive">Aggressive</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="aggressive">
                                    <span class="ml-2 min-w-[20px] text-center" id="aggressive-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="dominant">Dominant</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="dominant">
                                    <span class="ml-2 min-w-[20px] text-center" id="dominant-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2">4. Social Competence</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1" for="communication">Communication</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="communication">
                                    <span class="ml-2 min-w-[20px] text-center" id="communication-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="demanding">Demanding</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="demanding">
                                    <span class="ml-2 min-w-[20px] text-center" id="demanding-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="confidence">Confidence</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="confidence">
                                    <span class="ml-2 min-w-[20px] text-center" id="confidence-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Grade Selection -->
                <div class="mb-6">
                    <h3 class="font-medium text-lg mb-3">Player Grades</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="current-grade" class="block text-sm font-medium mb-1">Current Grade</label>
                            <select id="current-grade" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base">
                                <option value="A" selected>A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                        <div>
                            <label for="target-grade" class="block text-sm font-medium mb-1">Target Grade</label>
                            <select id="target-grade" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base">
                                <option value="A" selected>A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Feedback Section -->
                <div class="mb-6 space-y-4">
                    <div>
                        <label for="targeted-feedback" class="block text-sm font-medium mb-1">Targeted Feedback</label>
                        <textarea id="targeted-feedback" rows="4" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Provide specific targeted feedback for the player..."></textarea>
                    </div>
                    <div>
                        <label for="areas-improvement" class="block text-sm font-medium mb-1">Areas of Improvement</label>
                        <textarea id="areas-improvement" rows="4" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Identify key areas for improvement..."></textarea>
                    </div>
                </div>
                
                <!-- Report Signatures Section -->
                <div class="mb-6">
                    <h3 class="font-medium text-lg mb-3">Report Sign-off</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="coach1-name" class="block text-sm font-medium mb-1">Coach 1 Name</label>
                            <input type="text" id="coach1-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter coach's name" value="Melvin Chow">
                            <label for="coach1-title" class="block text-sm font-medium mb-1 mt-2">Title</label>
                            <input type="text" id="coach1-title" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter title" value="Coach">
                        </div>
                        <div>
                            <label for="coach2-name" class="block text-sm font-medium mb-1">Coach 2 Name</label>
                            <input type="text" id="coach2-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter coach's name" value="Lee Hong Lim">
                            <label for="coach2-title" class="block text-sm font-medium mb-1 mt-2">Title</label>
                            <input type="text" id="coach2-title" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter title" value="Coach">
                        </div>
                        <div>
                            <label for="technical-director" class="block text-sm font-medium mb-1">Technical Director</label>
                            <input type="text" id="technical-director" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter technical director's name" value="Darren Bowman">
                            <label for="technical-director-title" class="block text-sm font-medium mb-1 mt-2">Title</label>
                            <input type="text" id="technical-director-title" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base" placeholder="Enter title" value="Technical Director">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between">
                    <button id="generate-btn" class="px-6 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors">Generate Report</button>
                    <button id="reset-btn" class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors">Reset Form</button>
                </div>
            </div>

            <!-- Preview Section -->
            <div>
                <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-md mb-6">
                    <h2 class="text-xl font-semibold mb-4 text-primary">Report Preview</h2>
                    <div id="report-preview" class="bg-white dark:bg-gray-700 p-4 rounded-md min-h-[200px] overflow-auto">
                        <div class="text-center text-gray-500 dark:text-gray-400 py-12">Your report preview will appear here.</div>
                    </div>
                    <div id="pdf-controls" class="mt-4 text-center hidden">
                        <div class="flex justify-center space-x-4">
                            <button id="print-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2z" />
                                </svg>
                                Print Report
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Opens a new window with the report for printing or saving as PDF</p>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4 text-primary">Instructions</h2>
                    <div class="space-y-3 text-sm">
                        <p>1. Enter player information manually or upload from a file</p>
                        <p>2. Upload the player's portrait photo (optional)</p>
                        <p>3. Upload the club logo (optional)</p>
                        <p>4. Rate the player on all 12 performance metrics</p>
                        <p>5. Add detailed feedback and improvement areas</p>
                        <p>6. Click 'Generate Report' to preview</p>
                        <p>7. Use the 'Print Report' button to open a printable version</p>
                        <p>8. In the print dialog, select "Save as PDF" to download</p>
                        <p class="text-primary font-medium">Note: Player data is only used for the current session and isn't saved between sessions.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-md mt-6">
            <h2 class="text-xl font-semibold mb-4 text-primary">Saved Reports</h2>
            <div id="saved-reports-list" class="space-y-2">
                <p class="text-gray-500 dark:text-gray-400">No reports saved yet.</p>
            </div>
        </div>
        
        <!-- Status Message -->
        <div id="status-message" class="mt-6 py-2 px-4 rounded-md hidden"></div>
    </div>

    <!-- Print Container -->
    <div id="print-container" class="text-black">
        <!-- Report content will be added here when printing -->
        <button id="back-to-editor-btn" class="print-back-btn no-print hidden">Back to Editor</button>
    </div>

    <script>
    // Default club logo as SVG data
    const defaultClubLogoSVG = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="club-logo">
            <circle cx="50" cy="50" r="45" fill="#FFD700" />
            <circle cx="50" cy="50" r="38" fill="#FFFFFF" />
            <path d="M30,35 L30,65 L35,65 L35,50 L50,50 L50,65 L55,65 L55,35 L50,35 L50,45 L35,45 L35,35 Z" fill="#022C5F"/>
            <path d="M60,35 L60,65 L75,65 C77,65 78.5,64.5 79.5,63.5 C80.5,62.5 81,61 81,59 L81,41 C81,39 80.5,37.5 79.5,36.5 C78.5,35.5 77,35 75,35 Z M65,40 L75,40 L75,60 L65,60 Z" fill="#022C5F"/>
        </svg>
    `;

	// Global variables
	let clubLogoData = null;
	let currentReportHTML = "";
	let playersData = [];
	let selectedPlayerData = null;
	let portraitImageData = null;
	let savedReports = [];
	let currentHeightGrowthData = []; // Store height growth data
	let currentTotalGrowth = 0; // Store total growth


    // DOM elements
    const manualPlayerDataRadio = document.getElementById('manual-player-data');
    const filePlayerDataRadio = document.getElementById('file-player-data');
    const playerFileSection = document.getElementById('player-file-input');
    const playerManualInput = document.getElementById('player-manual-input');
    const xlsFileInput = document.getElementById('xlsFile');
    const portraitFileInput = document.getElementById('portraitFile');
    const clubLogoFileInput = document.getElementById('clubLogoFile');
    const playerSelectContainer = document.getElementById('playerSelectContainer');
    const playerSelect = document.getElementById('playerSelect');
    const generateBtn = document.getElementById('generate-btn');
    const resetBtn = document.getElementById('reset-btn');
    const reportPreview = document.getElementById('report-preview');
    const statusMessage = document.getElementById('status-message');
    const pdfControls = document.getElementById('pdf-controls');
    const printBtn = document.getElementById('print-btn');
    const manualFirstName = document.getElementById('manual-first-name');
    const manualLastName = document.getElementById('manual-last-name');
    const manualDob = document.getElementById('manual-dob');
    const manualPosition = document.getElementById('manual-position');

    // Sliders array
    const sliders = [
        'movement-to-receive', 'actions-to-create', 'actions-to-disrupt',
        'with-balance', 'with-speed', 'execution',
        'speed', 'aggressive', 'dominant',
        'communication', 'demanding', 'confidence'
    ];

    // Event Listeners
    clubLogoFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) {
            clubLogoData = null;
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            clubLogoData = e.target.result;
            showStatus('Club logo uploaded successfully!', 'success');
        };
        reader.readAsDataURL(file);
    });

    manualPlayerDataRadio.addEventListener('change', () => {
        if (manualPlayerDataRadio.checked) {
            playerFileSection.classList.add('hidden');
            playerManualInput.classList.remove('hidden');
            selectedPlayerData = null;
        }
    });

    filePlayerDataRadio.addEventListener('change', () => {
        if (filePlayerDataRadio.checked) {
            playerFileSection.classList.remove('hidden');
            playerManualInput.classList.add('hidden');
        }
    });

    const toggleAttendanceBtn = document.getElementById('toggle-attendance');
    const toggleAttendanceText = document.getElementById('toggle-attendance-text');
    const attendanceSection = document.getElementById('attendance-section');
    toggleAttendanceBtn.addEventListener('click', () => {
        attendanceSection.classList.toggle('hidden');
        toggleAttendanceText.textContent = attendanceSection.classList.contains('hidden') ? 'Show Section' : 'Hide Section';
    });

    const manualAttendanceRadio = document.getElementById('manual-attendance');
    const fileAttendanceRadio = document.getElementById('file-attendance');
    const attendanceFileSection = document.getElementById('attendance-file-input');
    const attendanceManualInput = document.getElementById('attendance-manual-input');
    manualAttendanceRadio.addEventListener('change', () => {
        if (manualAttendanceRadio.checked) {
            attendanceFileSection.classList.add('hidden');
            attendanceManualInput.classList.remove('hidden');
        }
    });
    fileAttendanceRadio.addEventListener('change', () => {
        if (fileAttendanceRadio.checked) {
            attendanceFileSection.classList.remove('hidden');
            attendanceManualInput.classList.add('hidden');
        }
    });

	// Height Growth Section Toggle
	const toggleHeightGrowthBtn = document.getElementById('toggle-height-growth');
	const toggleHeightGrowthText = document.getElementById('toggle-height-growth-text');
	const heightGrowthSection = document.getElementById('height-growth-section');
	toggleHeightGrowthBtn.addEventListener('click', () => {
		heightGrowthSection.classList.toggle('hidden');
		toggleHeightGrowthText.textContent = heightGrowthSection.classList.contains('hidden') ? 'Show Section' : 'Hide Section';
	});

	// Populate the year dropdown with a range of years (2022 to current year)
	const heightYearSelect = document.getElementById('height-year');
	const currentYear = new Date().getFullYear();
	for (let year = 2022; year <= currentYear; year++) {
		const option = document.createElement('option');
		option.value = year;
		option.textContent = year;
		if (year === currentYear) option.selected = true;
		heightYearSelect.appendChild(option);
	}

	// Dynamically generate height input fields based on selected month range
	const heightStartMonthSelect = document.getElementById('height-start-month');
	const heightEndMonthSelect = document.getElementById('height-end-month');
	const heightGrowthInputsDiv = document.getElementById('height-growth-inputs');

	function generateHeightInputs(startMonth, endMonth) {
		heightGrowthInputsDiv.innerHTML = ''; // Clear existing inputs
		const months = [
			'January', 'February', 'March', 'April', 'May', 'June',
			'July', 'August', 'September', 'October', 'November', 'December'
		];
		
		// Handle cases where endMonth is less than startMonth (e.g., November to February)
		let monthRange = [];
		if (endMonth >= startMonth) {
			for (let i = startMonth; i <= endMonth; i++) {
				monthRange.push(i);
			}
		} else {
			// If endMonth < startMonth, wrap around the year
			for (let i = startMonth; i < 12; i++) {
				monthRange.push(i);
			}
			for (let i = 0; i <= endMonth; i++) {
				monthRange.push(i);
			}
		}

		monthRange.forEach((monthIndex) => {
			const month = months[monthIndex];
			const inputDiv = document.createElement('div');
			inputDiv.innerHTML = `
				<label class="block text-sm mb-1" for="height-${month.toLowerCase()}">${month}</label>
				<input type="number" min="0" step="0.1" id="height-${month.toLowerCase()}" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base" placeholder="Height in cm" value="">
			`;
			heightGrowthInputsDiv.appendChild(inputDiv);
		});
	}

	// Initialize with default range (January to June)
	generateHeightInputs(parseInt(heightStartMonthSelect.value), parseInt(heightEndMonthSelect.value));

	// Update inputs when the start or end month changes
	heightStartMonthSelect.addEventListener('change', () => {
		const startMonth = parseInt(heightStartMonthSelect.value);
		const endMonth = parseInt(heightEndMonthSelect.value);
		generateHeightInputs(startMonth, endMonth);
	});

	heightEndMonthSelect.addEventListener('change', () => {
		const startMonth = parseInt(heightStartMonthSelect.value);
		const endMonth = parseInt(heightEndMonthSelect.value);
		generateHeightInputs(startMonth, endMonth);
	});




    const attendanceFileInput = document.getElementById('attendanceFile');
    attendanceFileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        try {
            showStatus('Reading attendance data...', 'info');
            const data = await file.arrayBuffer();
            const workbook = XLSX.read(data);
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const attendanceData = XLSX.utils.sheet_to_json(worksheet);
            
            if (attendanceData.length > 0 && selectedPlayerData) {
                const playerAttendance = attendanceData.find(record => 
                    record['First Name'] === selectedPlayerData['First Name'] && 
                    record['Last Name'] === selectedPlayerData['Last Name']
                );
                if (playerAttendance) {
                    document.getElementById('total-training-sessions').value = playerAttendance['Total Training Sessions'] || 0;
                    document.getElementById('training-sessions-attended').value = playerAttendance['Training Sessions Attended'] || 0;
                    document.getElementById('total-training-minutes').value = playerAttendance['Total Training Minutes'] || 0;
                    document.getElementById('total-matches').value = playerAttendance['Total Matches'] || 0;
                    document.getElementById('matches-played').value = playerAttendance['Matches Played'] || 0;
                    document.getElementById('total-match-minutes').value = playerAttendance['Total Match Minutes'] || 0;
                    document.getElementById('match-minutes-played').value = playerAttendance['Match Minutes Played'] || 0;
                    showStatus('Attendance data loaded successfully!', 'success');
                } else {
                    showStatus('No attendance data found for the selected player.', 'error');
                }
            } else {
                showStatus('No attendance data found or no player selected.', 'error');
            }
        } catch (error) {
            console.error('Error parsing attendance file:', error);
            showStatus('Error reading attendance data. Check file format.', 'error');
        }
    });

    sliders.forEach(id => {
        const slider = document.getElementById(id);
        const valueDisplay = document.getElementById(`${id}-value`);
        slider.addEventListener('input', () => valueDisplay.textContent = slider.value);
    });

    xlsFileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        try {
            showStatus('Reading player data...', 'info');
            const data = await file.arrayBuffer();
            const workbook = XLSX.read(data);
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            playersData = XLSX.utils.sheet_to_json(worksheet);
            
            if (playersData.length > 0) {
                playerSelect.innerHTML = '<option value="">Select a player...</option>';
                playersData.forEach((player, index) => {
                    const fullName = `${player['First Name'] || ''} ${player['Last Name'] || ''}`.trim();
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = fullName || `Player ${index + 1}`;
                    playerSelect.appendChild(option);
                });
                playerSelectContainer.classList.remove('hidden');
                showStatus(`${playersData.length} players loaded successfully!`, 'success');
            } else {
                showStatus('No player data found in the file.', 'error');
            }
        } catch (error) {
            console.error('Error parsing XLS file:', error);
            showStatus('Error reading player data. Check file format.', 'error');
        }
    });

    playerSelect.addEventListener('change', () => {
        const selectedIndex = playerSelect.value;
        if (selectedIndex === '') {
            selectedPlayerData = null;
            return;
        }
        selectedPlayerData = playersData[selectedIndex];
        showStatus(`Selected player: ${selectedPlayerData['First Name'] || ''} ${selectedPlayerData['Last Name'] || ''}`, 'info');
    });

    portraitFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) {
            portraitImageData = null;
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            portraitImageData = e.target.result;
            showStatus('Portrait uploaded successfully!', 'success');
        };
        reader.readAsDataURL(file);
    });

    generateBtn.addEventListener('click', () => {
        if (manualPlayerDataRadio.checked) {
            const firstName = manualFirstName.value.trim();
            const lastName = manualLastName.value.trim();
            if (!firstName || !lastName) {
                showStatus('Please enter both first and last name for manual input.', 'error');
                return;
            }
            selectedPlayerData = {
                'First Name': firstName,
                'Last Name': lastName,
                'Date of Birth': manualDob.value || '',
                'Position': manualPosition.value.trim() || ''
            };
        } else if (filePlayerDataRadio.checked && !selectedPlayerData) {
            showStatus('Please select a player from the uploaded file.', 'error');
            return;
        }
        if (!selectedPlayerData) {
            showStatus('No player data available. Please provide player information.', 'error');
            return;
        }
        generateReport();
    });

    resetBtn.addEventListener('click', () => {
    manualFirstName.value = '';
    manualLastName.value = '';
    manualDob.value = '';
    manualPosition.value = '';
    sliders.forEach(id => {
        const slider = document.getElementById(id);
        const valueDisplay = document.getElementById(`${id}-value`);
        slider.value = 3;
        valueDisplay.textContent = 3;
    });
    document.getElementById('total-training-sessions').value = 0;
    document.getElementById('training-sessions-attended').value = 0;
    document.getElementById('total-training-minutes').value = 0;
    document.getElementById('total-matches').value = 0;
    document.getElementById('matches-played').value = 0;
    document.getElementById('total-match-minutes').value = 0;
    document.getElementById('match-minutes-played').value = 0;
    document.getElementById('targeted-feedback').value = '';
    document.getElementById('areas-improvement').value = '';
    document.getElementById('coach1-name').value = 'Melvin Chow';
    document.getElementById('coach1-title').value = 'Coach';
    document.getElementById('coach2-name').value = 'Lee Hong Lim';
    document.getElementById('coach2-title').value = 'Coach';
    document.getElementById('technical-director').value = 'Darren Bowman';
    document.getElementById('technical-director-title').value = 'Technical Director';
    document.getElementById('current-grade').value = 'A';
    document.getElementById('target-grade').value = 'A';
    portraitImageData = null;
    clubLogoData = null;
    portraitFileInput.value = '';
    clubLogoFileInput.value = '';
    if (filePlayerDataRadio.checked) {
        selectedPlayerData = null;
        playerSelect.value = '';
    }
    reportPreview.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400 py-12">Your report preview will appear here.</div>';
    pdfControls.classList.add('hidden');
    // Reset height growth inputs
    document.getElementById('height-start-month').value = '0'; // Reset to January
    document.getElementById('height-end-month').value = '5'; // Reset to June
    document.getElementById('height-year').value = currentYear; // Reset to current year
    generateHeightInputs(0, 5); // Regenerate inputs for January to June
    const heightInputs = heightGrowthInputsDiv.querySelectorAll('input');
    heightInputs.forEach(input => input.value = '');
    // Reset height growth global variables
    currentHeightGrowthData = [];
    currentTotalGrowth = 0;
    showStatus('Form reset successfully.', 'success');
	});	

printBtn.addEventListener('click', () => {
    if (!currentReportHTML) {
        showStatus('Please generate a report first.', 'error');
        return;
    }
    try {
        let reportPlayerName = "Player Report";
        const nameMatch = currentReportHTML.match(/<h2 class="text-xl font-semibold">(.*?)<\/h2>/);
        if (nameMatch && nameMatch[1]) {
            reportPlayerName = nameMatch[1].trim();
        }
        
        const printWindow = window.open('', '_blank', 'width=800,height=600');
        if (!printWindow) {
            showStatus('Failed to open print window. Please check your browser settings and try again.', 'error');
            return;
        }
        
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${reportPlayerName} - Report</title>
                <style>
                    /* Basic reset */
                    * { box-sizing: border-box; margin: 0; padding: 0; }
                    
                    body { 
                        font-family: Arial, sans-serif;
                        line-height: 1.5;
                        color: #000;
                        background: #fff;
                        padding: 20px;
                    }
                    
                    /* Print-specific styles */
                    @media print {
                        @page {
                            size: A4 portrait;
                            margin: 1cm;
                        }
                        
                        body {
                            padding: 0;
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                            color-adjust: exact !important;
                        }
                        
                        h1, h2, h3, h4 {
                            page-break-after: avoid;
                        }
                        
                        .page-break-before {
                            page-break-before: always;
                        }
                        
                        #controls {
                            display: none !important;
                        }
                        
                        /* Ensure star colors are applied */
                        .gold-star, .gray-star {
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                            color-adjust: exact !important;
                        }
                    }
                    
                    /* Container */
                    .report {
                        max-width: 800px;
                        margin: 0 auto;
                    }
                    
                    /* Header */
                    .header {
                        display: flex;
                        align-items: center;
                        margin-bottom: 20px;
                        border-bottom: 2px solid #FFD700;
                        padding-bottom: 15px;
                    }
                    
                    .logo {
                        width: 60px;
                        margin-right: 15px;
                    }
                    
                    .title {
                        color: #FFD700;
                        font-size: 22px;
                        font-weight: bold;
                    }
                    
                    /* Player info */
                    .player-info {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 20px;
                    }
                    
                    .player-details {
                        flex: 1;
                    }
                    
                    .player-name {
                        font-size: 18px;
                        margin-bottom: 5px;
                    }
                    
                    .player-meta {
                        color: #666;
                        margin-bottom: 3px;
                    }
                    
                    .player-photo {
                        width: 100px;
                        height: 100px;
                        border: 1px solid #ddd;
                        overflow: hidden;
                    }
                    
                    .player-photo img {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                    }
                    
                    /* Section styling */
                    .section {
                        margin-bottom: 20px;
                    }
                    
                    /* Add more spacing after the last box in the last section (Areas of Improvement) */
                    .section:last-of-type .box:last-child {
                        margin-bottom: 40px;
                    }
                    
                    .section-title {
                        color: #FFD700;
                        font-size: 16px;
                        font-weight: bold;
                        margin-bottom: 10px;
                    }
                    
                    /* Two column layout */
                    .row {
                        display: flex;
                        flex-wrap: wrap;
                        margin: 0 -10px 15px -10px;
                    }
                    
                    .col {
                        flex: 1;
                        min-width: 250px;
                        padding: 0 10px;
                    }
                    
                    /* Bordered box */
                    .box {
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        padding: 10px;
                        margin-bottom: 15px;
                    }
                    
                    .box-title {
                        font-weight: bold;
                        margin-bottom: 8px;
                    }
                    
                    /* Data display */
                    .data-row {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 5px;
                    }
                    
                    .highlight {
                        font-weight: bold;
                        border-top: 1px solid #eee;
                        padding-top: 5px;
                        margin-top: 5px;
                    }
                    
                    /* Progress bar */
                    .progress-bar {
                        height: 8px;
                        background: #eee;
                        border-radius: 4px;
                        margin-top: 5px;
                        margin-bottom: 10px;
                        overflow: hidden;
                    }
                    
                    .progress-fill {
                        height: 100%;
                        background: #FFD700;
                    }
                    
                    .progress-green { background: #22c55e; }
                    .progress-amber { background: #f59e0b; }
                    .progress-red { background: #ef4444; }
                    
                    /* Rating stars */
                    .rating-row {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 3px;
                    }
                    
                    .stars {
                        letter-spacing: 2px;
                    }
                    
                    .gold-star { color: #FFD700 !important; }
                    .gray-star { color: #ddd !important; }
                    
                    /* Grades */
                    .grade {
                        display: block;
                        width: 100%;
                        height: auto;
                        padding: 8px;
                        text-align: center;
                        font-weight: bold;
                        font-size: 20px;
                        border-radius: 4px;
                    }
                    
                    .grade-a { background: #bbf7d0; color: #166534; }
                    .grade-b { background: #d9f99d; color: #3f6212; }
                    .grade-c { background: #fef08a; color: #854d0e; }
                    .grade-d { background: #fed7aa; color: #9a3412; }
                    .grade-e { background: #fecaca; color: #991b1b; }
                    
                    /* Chart */
                    .chart-container {
                        width: 160px;
                        margin: 0 auto;
                    }
                    
                    /* Signatures */
                    .signatures {
                        display: flex;
                        justify-content: space-between;
                        margin-top: 80px;
                        flex-wrap: wrap;
                    }
                    
                    .signature {
                        text-align: center;
                        margin-bottom: 20px;
                        flex: 1;
                        min-width: 150px;
                    }
                    
                    .signature-line {
                        width: 120px;
                        height: 1px;
                        background: #000;
                        margin: 0 auto 8px;
                    }
                    
                    .signature-name {
                        font-weight: bold;
                    }
                    
                    .signature-title {
                        color: #666;
                        font-size: 12px;
                    }
                    
                    /* Footer */
                    .footer {
                        text-align: center;
                        margin-top: 30px;
                        padding-top: 10px;
                        border-top: 1px solid #eee;
                        color: #666;
                        font-size: 12px;
                    }
                    
                    /* Controls */
                    #controls {
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        background: #FFD700;
                        padding: 10px;
                        border-radius: 4px;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                        z-index: 1000;
                    }
                    
                    #controls button {
                        background: white;
                        border: none;
                        padding: 8px 15px;
                        margin: 0 5px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-weight: bold;
                    }
                </style>
            </head>
            <body>
                <div id="report" class="report"></div>
                
                <div id="controls">
                    <button onclick="window.print()">Print Report</button>
                    <button onclick="window.close()">Close</button>
                </div>
            </body>
            </html>
        `);
        
        const reportDiv = printWindow.document.getElementById('report');
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = currentReportHTML;
        
        const playerNameEl = tempDiv.querySelector('h2.text-xl');
        const playerName = playerNameEl ? playerNameEl.textContent : '';
        
        const dobEl = tempDiv.querySelector('p:nth-of-type(1)');
        const dob = dobEl ? dobEl.textContent.replace('Date of Birth:', '').trim() : '';
        
        let position = '';
        const posEl = Array.from(tempDiv.querySelectorAll('p')).find(p => 
            p.textContent.includes('Position:'));
        if (posEl) position = posEl.textContent.replace('Position:', '').trim();
        
        const reviewDateEl = tempDiv.querySelector('p:last-of-type');
        const reviewDate = reviewDateEl ? reviewDateEl.textContent.replace('Review Date:', '').trim() : '';
        
        const logoEl = tempDiv.querySelector('.col-span-1 svg, .col-span-1 img');
        let logoHtml = '';
        if (logoEl) {
            const logoClone = logoEl.cloneNode(true);
            if (logoClone.style) logoClone.style.maxWidth = '60px';
            if (logoClone.style) logoClone.style.maxHeight = '60px';
            logoHtml = logoClone.outerHTML;
        }
        
        const portraitEl = tempDiv.querySelector('.w-32.h-32 img, .w-32.h-32 div');
        let portraitHtml = '';
        if (portraitEl) {
            portraitHtml = portraitEl.outerHTML;
        }
        
        // Function to find the .border div containing a specific section title
        function findSectionByTitle(tempDiv, title, headerTag = 'h3') {
            const sectionHeaders = tempDiv.querySelectorAll(`.border ${headerTag}`);
            for (let header of sectionHeaders) {
                if (header.textContent.trim() === title) {
                    return header.parentElement;
                }
            }
            return null;
        }

        // Extract attendance data for Training Attendance
        const trainingSection = findSectionByTitle(tempDiv, 'Training Attendance', 'h4');
        const attendanceData = [];
        if (trainingSection) {
            const trainingEls = trainingSection.querySelectorAll('.flex.justify-between');
            trainingEls.forEach(el => {
                const label = el.querySelector('span:first-child').textContent;
                const value = el.querySelector('span:last-child').textContent;
                attendanceData.push({ label, value });
            });
        }

        const trainingRate = attendanceData.find(d => d.label === 'Attendance Rate:')?.value || '0%';
        const trainingRateNum = parseFloat(trainingRate);

        // Extract match data for Match Clock
        const matchSection = findSectionByTitle(tempDiv, 'Match Clock', 'h4');
        const matchData = [];
        if (matchSection) {
            const matchEls = matchSection.querySelectorAll('.flex.justify-between');
            matchEls.forEach(el => {
                const label = el.querySelector('span:first-child').textContent;
                const value = el.querySelector('span:last-child').textContent;
                matchData.push({ label, value });
            });
        }

        const matchRate = matchData[matchData.length - 1]?.value || '0%';
        const matchRateNum = parseFloat(matchRate);

        const chartEl = tempDiv.querySelector('canvas, img[alt="Player Evaluation Radar"]');
        let chartHtml = '';
        if (chartEl) {
            if (chartEl.tagName === 'CANVAS') {
                chartHtml = `<div class="chart-info">Chart not available in print preview</div>`;
            } else {
                const chartClone = chartEl.cloneNode(true);
                chartClone.style.width = '160px';
                chartClone.style.height = '160px';
                chartHtml = chartClone.outerHTML;
            }
        }
        
        const gradeEls = tempDiv.querySelectorAll('.bg-green-200, .bg-lime-200, .bg-yellow-200, .bg-orange-200, .bg-red-200');
        const currentGrade = gradeEls[0] ? gradeEls[0].textContent.trim() : 'A';
        const targetGrade = gradeEls[1] ? gradeEls[1].textContent.trim() : 'A';
        
        function extractRatings(container) {
            const result = [];
            const ratingRows = container.querySelectorAll('.flex.justify-between');
            
            ratingRows.forEach(row => {
                const skill = row.querySelector('span:first-child').textContent;
                const rating = row.querySelector('span:last-child').textContent;
                const numRating = parseInt(rating.split('/')[0]);
                
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= numRating) {
                        stars += '<span class="gold-star"></span>';
                    } else {
                        stars += '<span class="gray-star"></span>';
                    }
                }
                
                result.push({ skill, rating, stars });
            });
            
            return result;
        }
        
        const gameIntelligence = findSectionByTitle(tempDiv, 'Game Intelligence');
        const gameRatings = gameIntelligence ? extractRatings(gameIntelligence) : [];
        
        const techAbility = findSectionByTitle(tempDiv, 'Technical Ability');
        const techRatings = techAbility ? extractRatings(techAbility) : [];
        
        const physCapacity = findSectionByTitle(tempDiv, 'Physical Capacity');
        const physRatings = physCapacity ? extractRatings(physCapacity) : [];
        
        const socialComp = findSectionByTitle(tempDiv, 'Social Competence');
        const socialRatings = socialComp ? extractRatings(socialComp) : [];
        
        const feedbackEls = tempDiv.querySelectorAll('.space-y-2 .border');
        const targetedFeedback = feedbackEls[0] ? 
            feedbackEls[0].querySelector('p').textContent : 'No feedback provided.';
            
        const areasImprovement = feedbackEls[1] ? 
            feedbackEls[1].querySelector('p').textContent : 'No areas of improvement identified.';
        
        const sigEls = tempDiv.querySelectorAll('.signature-section .text-center');
        const signatures = [];
        
        sigEls.forEach(sig => {
            const name = sig.querySelector('p:first-of-type').textContent;
            const title = sig.querySelector('p:last-of-type').textContent;
            signatures.push({ name, title });
        });
        
        // Use the globally stored height growth data
        const heightYear = parseInt(document.getElementById('height-year').value);
        const heightGrowthData = currentHeightGrowthData; // Use the stored data
        const totalGrowthPrint = currentTotalGrowth !== 0 ? `${currentTotalGrowth > 0 ? '+' : ''}${currentTotalGrowth} cm` : '';
        let expectedMonthCount = 1; // Default to 1 to avoid colspan="0"

        // Calculate expected month count for colspan when there's no data
        const startMonth = parseInt(document.getElementById('height-start-month').value);
        const endMonth = parseInt(document.getElementById('height-end-month').value);
        let monthRange = [];
        if (endMonth >= startMonth) {
            for (let i = startMonth; i <= endMonth; i++) {
                monthRange.push(i);
            }
        } else {
            for (let i = startMonth; i < 12; i++) {
                monthRange.push(i);
            }
            for (let i = 0; i <= endMonth; i++) {
                monthRange.push(i);
            }
        }
        expectedMonthCount = monthRange.length || 1;
        
        const reportHtml = `
            <div class="header">
                <div class="logo">${logoHtml}</div>
                <div class="title">Player Performance Review</div>
            </div>
            
            <div class="player-info">
                <div class="player-details">
                    <div class="player-name">${playerName}</div>
                    <div class="player-meta">Date of Birth: ${dob}</div>
                    ${position ? `<div class="player-meta">Position: ${position}</div>` : ''}
                    <div class="player-meta">Review Date: ${reviewDate}</div>
                </div>
                <div class="player-photo">${portraitHtml}</div>
            </div>

            <div class="section">
                <div class="section-title">Height Growth Over Season (${heightYear})</div>
                <div class="box">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <th style="padding: 8px; text-align: left;">Month</th>
                                ${heightGrowthData.map(data => `
                                    <th style="padding: 8px; text-align: left;">${data.month}</th>
                                `).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 8px;">Height (cm)</td>
                                ${heightGrowthData.length > 0 ? heightGrowthData.map(data => `
                                    <td style="padding: 8px;">${data.height}</td>
                                `).join('') : `
                                    <td colspan="${expectedMonthCount}" style="padding: 8px; text-align: center; color: #666;">No height data available.</td>
                                `}
                            </tr>
                            ${heightGrowthData.length > 1 && totalGrowthPrint ? `
                                <tr style="font-weight: bold; color: #FFD700;">
                                    <td style="padding: 8px;">Total Growth:</td>
                                    <td colspan="${heightGrowthData.length}" style="padding: 8px;">${totalGrowthPrint}</td>
                                </tr>
                            ` : ''}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Player Attendance</div>
                <div class="row">
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Training Attendance</div>
                            ${attendanceData.slice(0, 3).map(item => `
                                <div class="data-row">
                                    <span>${item.label}</span>
                                    <span>${item.value}</span>
                                </div>
                            `).join('')}
                            <div class="data-row highlight">
                                <span>Attendance Rate:</span>
                                <span>${trainingRate}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ${trainingRateNum >= 80 ? 'progress-green' : trainingRateNum >= 60 ? 'progress-amber' : 'progress-red'}" 
                                     style="width: ${trainingRateNum}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Match Clock</div>
                            ${matchData.slice(0, 4).map(item => `
                                <div class="data-row">
                                    <span>${item.label}</span>
                                    <span>${item.value}</span>
                                </div>
                            `).join('')}
                            <div class="data-row highlight">
                                <span>Match Attendance Rate:</span>
                                <span>${matchRate}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ${matchRateNum >= 80 ? 'progress-green' : matchRateNum >= 60 ? 'progress-amber' : 'progress-red'}" 
                                     style="width: ${matchRateNum}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="row">
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Player Evaluation Radar</div>
                            <div class="chart-container">${chartHtml}</div>
                        </div>
                    </div>
                    
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Player Grades</div>
                            <div style="margin-bottom: 15px;">
                                <div style="margin-bottom: 5px;">Current Grade</div>
                                <div class="grade grade-${currentGrade.toLowerCase()}">${currentGrade}</div>
                            </div>
                            <div>
                                <div style="margin-bottom: 5px;">Target Grade</div>
                                <div class="grade grade-${targetGrade.toLowerCase()}">${targetGrade}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section page-break-before">
                <div class="row">
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Game Intelligence</div>
                            ${gameRatings.map(rating => `
                                <div style="margin-bottom: 8px;">
                                    <div class="rating-row">
                                        <span>${rating.skill}</span>
                                        <span>${rating.rating}</span>
                                    </div>
                                    <div class="stars">${rating.stars}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Technical Ability</div>
                            ${techRatings.map(rating => `
                                <div style="margin-bottom: 8px;">
                                    <div class="rating-row">
                                        <span>${rating.skill}</span>
                                        <span>${rating.rating}</span>
                                    </div>
                                    <div class="stars">${rating.stars}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Physical Capacity</div>
                            ${physRatings.map(rating => `
                                <div style="margin-bottom: 8px;">
                                    <div class="rating-row">
                                        <span>${rating.skill}</span>
                                        <span>${rating.rating}</span>
                                    </div>
                                    <div class="stars">${rating.stars}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="col">
                        <div class="box">
                            <div class="box-title">Social Competence</div>
                            ${socialRatings.map(rating => `
                                <div style="margin-bottom: 8px;">
                                    <div class="rating-row">
                                        <span>${rating.skill}</span>
                                        <span>${rating.rating}</span>
                                    </div>
                                    <div class="stars">${rating.stars}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="box">
                    <div class="box-title">Targeted Feedback</div>
                    <p>${targetedFeedback}</p>
                </div>
                
                <div class="box">
                    <div class="box-title">Areas of Improvement</div>
                    <p>${areasImprovement}</p>
                </div>
            </div>
            
            <div class="signatures">
                ${signatures.map(sig => `
                    <div class="signature">
                        <div class="signature-line"></div>
                        <div class="signature-name">${sig.name}</div>
                        <div class="signature-title">${sig.title}</div>
                    </div>
                `).join('')}
            </div>
            
            <div class="footer">
                <div>Lee Man Football Club - Player Development Report</div>
                <div>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</div>
            </div>
        `;
        
        reportDiv.innerHTML = reportHtml;
        printWindow.document.close();
        
        // Add error handling for the print window
        printWindow.onerror = (message, source, lineno, colno, error) => {
            console.error('Print window error:', message, 'at', source, 'line', lineno, 'column', colno, 'Error object:', error);
            showStatus('Error in print window: ' + message, 'error');
        };
        
        showStatus('Print window opened. Use browser print dialog to save as PDF.', 'success');
    } catch (error) {
        console.error('Error preparing print view:', error);
        showStatus('Error: ' + error.message, 'error');
    }
});



    function updateSavedReportsList() {
        const savedReportsList = document.getElementById('saved-reports-list');
        if (savedReports.length === 0) {
            savedReportsList.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No reports saved yet.</p>';
            return;
        }
        savedReportsList.innerHTML = savedReports.map((report, index) => `
            <div class="flex justify-between items-center p-2 bg-white dark:bg-gray-700 rounded-md">
                <span>${report.name} - ${new Date(report.timestamp).toLocaleString()}</span>
                <div class="space-x-2">
                    <button class="view-saved-report px-3 py-1 bg-primary text-white rounded-md hover:bg-secondary" data-index="${index}">View</button>
                    <button class="delete-saved-report px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600" data-index="${index}">Delete</button>
                </div>
            </div>
        `).join('');
    }

    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('view-saved-report')) {
            const index = e.target.getAttribute('data-index');
            const report = savedReports[index];
            reportPreview.innerHTML = report.html;
            currentReportHTML = report.html;
            pdfControls.classList.remove('hidden');
            showStatus(`Viewing saved report for ${report.name}`, 'info');
        } else if (e.target.classList.contains('delete-saved-report')) {
            const index = e.target.getAttribute('data-index');
            const reportName = savedReports[index].name;
            savedReports.splice(index, 1);
            updateSavedReportsList();
            showStatus(`Deleted saved report for ${reportName}`, 'success');
        }
    });

	 function generateReport() {
		if (!selectedPlayerData) {
			showStatus('No player data available to generate report.', 'error');
			return;
		}
		showStatus('Generating report...', 'info');

		try {
			const playerInfo = {
				firstName: selectedPlayerData['First Name'] || 'Unknown',
				lastName: selectedPlayerData['Last Name'] || 'Player',
				sdob: formatExcelDate(selectedPlayerData['Date of Birth']),
				position: selectedPlayerData['Position'] || ''
			};

			// Collect height growth data
			const startMonth = parseInt(document.getElementById('height-start-month').value);
			const endMonth = parseInt(document.getElementById('height-end-month').value);
			const heightYear = parseInt(document.getElementById('height-year').value);
			const months = [
				'january', 'february', 'march', 'april', 'may', 'june',
				'july', 'august', 'september', 'october', 'november', 'december'
			];
			const monthDisplayNames = [
				'January', 'February', 'March', 'April', 'May', 'June',
				'July', 'August', 'September', 'October', 'November', 'December'
			];
			const heightData = [];
			let totalGrowth = 0;
			let firstHeight = null;
			let lastHeight = null;

			// Determine the range of months
			let monthRange = [];
			if (endMonth >= startMonth) {
				for (let i = startMonth; i <= endMonth; i++) {
					monthRange.push(i);
				}
			} else {
				for (let i = startMonth; i < 12; i++) {
					monthRange.push(i);
				}
				for (let i = 0; i <= endMonth; i++) {
					monthRange.push(i);
				}
			}

			// Collect height data for the selected months
			monthRange.forEach((monthIndex) => {
				const month = months[monthIndex];
				const displayMonth = monthDisplayNames[monthIndex];
				const heightInput = document.getElementById(`height-${month}`);
				const height = parseFloat(heightInput?.value) || 0;
				if (height > 0) {
					heightData.push({ month: displayMonth, height: height.toFixed(1) });
					if (firstHeight === null) firstHeight = height;
					lastHeight = height;
				}
			});

			if (firstHeight !== null && lastHeight !== null && firstHeight !== lastHeight) {
				totalGrowth = (lastHeight - firstHeight).toFixed(1);
			}

			// Store the height data and total growth globally
			currentHeightGrowthData = heightData;
			currentTotalGrowth = totalGrowth;

			// Rest of the generateReport function remains the same...
			function formatExcelDate(excelDate) {
				if (!excelDate) return 'N/A';
				try {
					if (typeof excelDate === 'number' || !isNaN(Number(excelDate))) {
						const serialDate = Number(excelDate);
						if (serialDate < 1 || serialDate > 2958465) return String(excelDate);
						const jsDate = new Date((serialDate - 1) * 86400000 + new Date(1900, 0, 1).getTime());
						if (isNaN(jsDate.getTime())) return String(excelDate);
						return jsDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
					} else if (typeof excelDate === 'string') {
						const date = new Date(excelDate);
						if (!isNaN(date.getTime())) return date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
						return excelDate;
					}
					return String(excelDate);
				} catch (error) {
					console.error('Error formatting date:', error);
					return String(excelDate);
				}
			}

			const attendanceData = {
				training: {
					totalSessions: parseInt(document.getElementById('total-training-sessions')?.value || 0),
					sessionsAttended: parseInt(document.getElementById('training-sessions-attended')?.value || 0),
					totalMinutes: parseInt(document.getElementById('total-training-minutes')?.value || 0)
				},
				match: {
					totalMatches: parseInt(document.getElementById('total-matches')?.value || 0),
					matchesPlayed: parseInt(document.getElementById('matches-played')?.value || 0),
					totalMinutes: parseInt(document.getElementById('total-match-minutes')?.value || 0),
					minutesPlayed: parseInt(document.getElementById('match-minutes-played')?.value || 0)
				}
			};

			const trainingAttendancePercentage = attendanceData.training.totalSessions > 0 
				? (attendanceData.training.sessionsAttended / attendanceData.training.totalSessions * 100).toFixed(1) 
				: 0;
			const matchMinutesPercentage = attendanceData.match.totalMinutes > 0 
				? (attendanceData.match.minutesPlayed / attendanceData.match.totalMinutes * 100).toFixed(1) 
				: 0;

			let attendanceBarColor = 'bg-gray-500';
			if (trainingAttendancePercentage >= 80) {
				attendanceBarColor = 'bg-green-500';
			} else if (trainingAttendancePercentage > 60 && trainingAttendancePercentage < 80) {
				attendanceBarColor = 'bg-amber-500';
			} else if (trainingAttendancePercentage <= 60) {
				attendanceBarColor = 'bg-red-500';
			}

			const ratings = {};
			sliders.forEach(id => {
				const slider = document.getElementById(id);
				ratings[id] = slider ? parseInt(slider.value) : 3;
			});

			const gameIntelligenceAvg = ((ratings['movement-to-receive'] + ratings['actions-to-create'] + ratings['actions-to-disrupt']) / 3).toFixed(1);
			const technicalAbilityAvg = ((ratings['with-balance'] + ratings['with-speed'] + ratings['execution']) / 3).toFixed(1);
			const physicalCapacityAvg = ((ratings['speed'] + ratings['aggressive'] + ratings['dominant']) / 3).toFixed(1);
			const socialCompetenceAvg = ((ratings['communication'] + ratings['demanding'] + ratings['confidence']) / 3).toFixed(1);

			const coach1Name = document.getElementById('coach1-name')?.value || 'Melvin Chow';
			const coach1Title = document.getElementById('coach1-title')?.value || 'Coach';
			const coach2Name = document.getElementById('coach2-name')?.value || 'Lee Hong Lim';
			const coach2Title = document.getElementById('coach2-title')?.value || 'Coach';
			const technicalDirector = document.getElementById('technical-director')?.value || 'Darren Bowman';
			const technicalDirectorTitle = document.getElementById('technical-director-title')?.value || 'Technical Director';
			const targetedFeedback = document.getElementById('targeted-feedback')?.value || '';
			const areasImprovement = document.getElementById('areas-improvement')?.value || '';
			const currentGrade = document.getElementById('current-grade')?.value || 'A';
			const targetGrade = document.getElementById('target-grade')?.value || 'A';

			const gradeStyles = {
				'A': 'bg-green-200 text-green-800 font-semibold',
				'B': 'bg-lime-200 text-lime-800 font-semibold',
				'C': 'bg-yellow-200 text-yellow-800 font-semibold',
				'D': 'bg-orange-200 text-orange-800 font-semibold',
				'E': 'bg-red-200 text-red-800 font-semibold'
			};
			const currentGradeStyle = gradeStyles[currentGrade] || 'bg-gray-200 text-gray-800';
			const targetGradeStyle = gradeStyles[targetGrade] || 'bg-gray-200 text-gray-800';

			let clubLogoHTML = clubLogoData ? `<img src="${clubLogoData}" alt="Club Logo" class="w-full h-auto">` : defaultClubLogoSVG;
			let portraitHTML = portraitImageData 
				? `<img src="${portraitImageData}" alt="Player Portrait" class="w-full h-full object-cover border-2 border-gray-300">` 
				: '<div class="w-full h-full bg-gray-200 flex items-center justify-center border-2 border-gray-300"><span class="text-gray-500">No Photo</span></div>';
			let positionHTML = playerInfo.position ? `<p class="text-gray-600">Position: ${playerInfo.position}</p>` : '';

			const reportHTML = `
				<div class="bg-white text-black p-8 print:p-[0.5cm] w-full max-w-[19cm] mx-auto" id="report-container" style="height: auto; overflow: visible; page-break-inside: auto; break-inside: auto;">
					<div class="mb-6 border-b-2 border-primary pb-4">
						<div class="grid grid-cols-6 gap-4 mb-4">
							<div class="col-span-1">${clubLogoHTML}</div>
							<div class="col-span-5">
								<h1 class="text-3xl font-bold text-primary">Player Performance Review</h1>
							</div>
						</div>
						<div class="grid grid-cols-4 gap-4">
							<div class="col-span-3">
								<h2 class="text-xl font-semibold">${playerInfo.firstName} ${playerInfo.lastName}</h2>
								<p class="text-gray-600">Date of Birth: ${playerInfo.sdob}</p>
								${positionHTML}
								<p class="text-gray-600">Review Date: ${new Date().toLocaleDateString()}</p>
							</div>
							<div class="col-span-1">
								<div class="w-32 h-32 overflow-hidden">${portraitHTML}</div>
							</div>
						</div>
					</div>
					
					<div class="mb-8">
						<h3 class="font-bold text-xl mb-4 text-primary">Height Growth Over Season (${heightYear})</h3>
						<div class="border rounded-lg p-2">
							<div class="space-y-2">
								<table class="w-full text-left">
									<thead>
										<tr class="border-b">
											<th class="py-2 px-4">Month</th>
											${heightData.map(data => `
												<th class="py-2 px-4">${data.month}</th>
											`).join('')}
										</tr>
									</thead>
									<tbody>
										<tr class="border-b">
											<td class="py-2 px-4">Height (cm)</td>
											${heightData.length > 0 ? heightData.map(data => `
												<td class="py-2 px-4">${data.height}</td>
											`).join('') : `
												<td colspan="${monthRange.length}" class="py-2 px-4 text-center text-gray-500">No height data available.</td>
											`}
										</tr>
										${heightData.length > 1 && totalGrowth !== 0 ? `
											<tr class="font-semibold text-primary">
												<td class="py-2 px-4">Total Growth:</td>
												<td colspan="${monthRange.length}" class="py-2 px-4">${totalGrowth > 0 ? '+' : ''}${totalGrowth} cm</td>
											</tr>
										` : ''}
									</tbody>
								</table>
							</div>
						</div>
					</div>
					
					<div class="mb-8">
						<h3 class="font-bold text-xl mb-4 text-primary">Player Attendance</h3>
						<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
							<div class="border rounded-lg p-2">
								<h4 class="font-bold text-lg mb-3">Training Attendance</h4>
								<div class="space-y-2">
									<div class="flex justify-between"><span>Total Training Sessions:</span><span class="font-medium">${attendanceData.training.totalSessions}</span></div>
									<div class="flex justify-between"><span>Sessions Attended:</span><span class="font-medium">${attendanceData.training.sessionsAttended}</span></div>
									<div class="flex justify-between"><span>Total Training Minutes:</span><span class="font-medium">${attendanceData.training.totalMinutes}</span></div>
									<div class="flex justify-between text-primary font-semibold mt-2 pt-2 border-t"><span>Attendance Rate:</span><span>${trainingAttendancePercentage}%</span></div>
									<div class="w-full bg-gray-200 rounded-full h-2.5 mt-1"><div class="${attendanceBarColor} h-2.5 rounded-full" style="width: ${trainingAttendancePercentage}%"></div></div>
								</div>
							</div>
							<div class="border rounded-lg p-2">
								<h4 class="font-bold text-lg mb-3">Match Clock</h4>
								<div class="space-y-2">
									<div class="flex justify-between"><span>Total Matches:</span><span class="font-medium">${attendanceData.match.totalMatches}</span></div>
									<div class="flex justify-between"><span>Played:</span><span class="font-medium">${attendanceData.match.matchesPlayed}</span></div>
									<div class="flex justify-between"><span>Total Minutes:</span><span class="font-medium">${attendanceData.match.totalMinutes}</span></div>
									<div class="flex justify-between"><span>Minutes Played:</span><span class="font-medium">${attendanceData.match.minutesPlayed}</span></div>
									<div class="flex justify-between text-primary font-semibold mt-2 pt-2 border-t"><span> </span><span>${matchMinutesPercentage}%</span></div>
									<div class="w-full bg-gray-200 rounded-full h-2.5 mt-1"><div class="bg-primary h-2.5 rounded-full" style="width: ${matchMinutesPercentage}%"></div></div>
								</div>
							</div>
						</div>
					</div>
					<div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-6">
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-lg mb-2 text-primary">Player Evaluation Radar</h3>
							<div class="flex justify-center"><div style="width: 150px; height: 150px;"><canvas id="skills-radar"></canvas></div></div>
						</div>
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-lg mb-2 text-primary">Player Grades</h3>
							<div class="grid grid-cols-1 gap-4">
								<div>
									<p class="font-medium text-base">Current Grade</p>
									<p class="${currentGradeStyle} text-center text-lg p-2 rounded-md">${currentGrade}</p>
								</div>
								<div>
									<p class="font-medium text-base">Target Grade</p>
									<p class="${targetGradeStyle} text-center text-lg p-2 rounded-md">${targetGrade}</p>
								</div>
							</div>
						</div>
					</div>
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-base mb-1 text-primary">Game Intelligence</h3>
							<div class="space-y-1 text-base">
								${createRatingBar('Movement to Receive', ratings['movement-to-receive'])}
								${createRatingBar('Actions to Create', ratings['actions-to-create'])}
								${createRatingBar('Actions to Disrupt', ratings['actions-to-disrupt'])}
							</div>
						</div>
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-base mb-1 text-primary">Technical Ability</h3>
							<div class="space-y-1 text-base">
								${createRatingBar('With Balance', ratings['with-balance'])}
								${createRatingBar('With Speed', ratings['with-speed'])}
								${createRatingBar('Execution', ratings['execution'])}
							</div>
						</div>
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-base mb-1 text-primary">Physical Capacity</h3>
							<div class="space-y-1 text-base">
								${createRatingBar('Speed', ratings['speed'])}
								${createRatingBar('Aggressive', ratings['aggressive'])}
								${createRatingBar('Dominant', ratings['dominant'])}
							</div>
						</div>
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-base mb-1 text-primary">Social Competence</h3>
							<div class="space-y-1 text-base">
								${createRatingBar('Communication', ratings['communication'])}
								${createRatingBar('Demanding', ratings['demanding'])}
								${createRatingBar('Confidence', ratings['confidence'])}
							</div>
						</div>
					</div>
					<div class="space-y-2 mb-4">
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-base mb-1 text-primary">Targeted Feedback</h3>
							<p class="whitespace-pre-line text-base">${targetedFeedback || 'No feedback provided.'}</p>
						</div>
						<div class="border rounded-lg p-2">
							<h3 class="font-bold text-base mb-1 text-primary">Areas of Improvement</h3>
							<p class="whitespace-pre-line text-base">${areasImprovement || 'No areas of improvement identified.'}</p>
						</div>
					</div>
					<div class="mt-6 mb-4 signature-section">
						<div class="flex flex-wrap justify-between">
							<div class="text-center mx-2 mb-2"><div class="signature-line"></div><p class="mt-1 text-base">${coach1Name}</p><p class="text-sm text-gray-600">${coach1Title}</p></div>
							<div class="text-center mx-2 mb-2"><div class="signature-line"></div><p class="mt-1 text-base">${coach2Name}</p><p class="text-sm text-gray-600">${coach2Title}</p></div>
							<div class="text-center mx-2 mb-2"><div class="signature-line"></div><p class="mt-1 text-base">${technicalDirector}</p><p class="text-sm text-gray-600">${technicalDirectorTitle}</p></div>
						</div>
					</div>
					<div class="text-center text-sm text-gray-500 border-t-2 border-gray-200 pt-2 mt-4">
						<p>Lee Man Football Club - Player Development Report</p>
						<p>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
					</div>
				</div>
			`;

        currentReportHTML = reportHTML;
        reportPreview.innerHTML = reportHTML;
        pdfControls.classList.remove('hidden');

        const canvas = document.getElementById('skills-radar');
        if (!canvas || !canvas.getContext) {
            console.error('Canvas element not found or context unavailable');
            showStatus('Error: Skills chart could not be rendered.', 'error');
            return;
        }
        const ctx = canvas.getContext('2d');
        if (window.skillsChart) window.skillsChart.destroy();

        window.skillsChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['Game Intelligence', 'Technical Ability', 'Physical Capacity', 'Social Competence'],
                datasets: [{
                    label: 'Player Skills',
                    data: [gameIntelligenceAvg, technicalAbilityAvg, physicalCapacityAvg, socialCompetenceAvg],
                    backgroundColor: 'rgba(255, 215, 0, 0.2)',
                    borderColor: '#FFD700',
                    pointBackgroundColor: '#FFD700',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#FFD700'
                }]
            },
            options: {
                animation: {
                    onComplete: () => {
                        const chartImage = canvas.toDataURL('image/png');
                        currentReportHTML = currentReportHTML.replace(
                            '<canvas id="skills-radar"></canvas>',
                            `<img src="${chartImage}" alt="Player Evaluation Radar" style="width: 150px; height: 150px;">`
                        );
                        reportPreview.innerHTML = currentReportHTML;

                        const playerName = `${playerInfo.firstName} ${playerInfo.lastName}`;
                        const reportEntry = {
                            name: playerName,
                            html: currentReportHTML,
                            timestamp: new Date().toISOString()
                        };
                        savedReports.push(reportEntry);
                        updateSavedReportsList();
                        showStatus('Report generated and saved successfully!', 'success');
                    }
                },
                plugins: { legend: { display: false } },
                scales: { r: { angleLines: { display: true }, min: 0, max: 5, ticks: { stepSize: 1 } } }
            }
        });
    } catch (error) {
        console.error('Error in generateReport:', error);
        showStatus('Error generating report: ' + error.message, 'error');
    }
}

    function createRatingBar(label, value) {
        const stars = Array(5).fill(0).map((_, i) => 
            i < value ? '<span class="text-primary"></span>' : '<span class="text-gray-300"></span>'
        ).join('');
        return `
            <div>
                <div class="flex justify-between mb-1"><span class="text-sm">${label}</span><span class="text-sm">${value}/5</span></div>
                <div class="flex">${stars}</div>
            </div>
        `;
    }

    function showStatus(message, type) {
        statusMessage.textContent = message;
        statusMessage.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');
        switch (type) {
            case 'success': statusMessage.classList.add('bg-green-100', 'text-green-800'); break;
            case 'error': statusMessage.classList.add('bg-red-100', 'text-red-800'); break;
            case 'info': default: statusMessage.classList.add('bg-blue-100', 'text-blue-800'); break;
        }
        if (type !== 'error') setTimeout(() => statusMessage.classList.add('hidden'), 5000);
    }
    </script>
    

</body>
</html>