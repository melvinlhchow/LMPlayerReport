<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lee Man Youth Academy Player Review Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />	
    <!-- For A4 paper printing -->
    <style>
    @media print {
        @page {
            size: A4 portrait;
            margin: 1cm;
        }
        html, body {
            height: auto !important;
            overflow: visible !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            color-adjust: exact;
            margin: 0;
            background-color: white;
        }
        .no-print, .hide-for-print, .print-back-btn { 
            display: none !important; 
        }
        .page-break { 
            page-break-before: always !important; 
            break-before: page !important;
            display: block !important;
            height: 0 !important;
            clear: both !important;
        }

		#report-container {
			width: 100% !important;
			max-width: 19cm !important; /* Match the preview’s max-width */
			padding: 0.5cm !important;
			margin: 0 auto !important;
			box-sizing: border-box !important;
			height: auto !important;
			overflow: visible !important;
		}

        #app-container {
            display: none !important; 
        }
        #print-container {
            display: block !important;
            position: static !important;
            width: 100%;
            height: auto !important;
            overflow: visible !important;
            background: white !important;
            z-index: auto !important;
            padding: 0 !important;
        }
        .grid-2x2 {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
        }
        

		/* Preserve the 2-column grid for specific sections */
		.grid.grid-cols-1.md\:grid-cols-2 {
			display: grid !important;
			grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
			gap: 1.5rem !important; /* Match the gap-6 (1.5rem) */
		}

        /* Reset container sizes */
        *, *::before, *::after {
            box-sizing: border-box !important;
        }
        
        /* Ensure headings don't get separated from their content */
        h1, h2, h3, h4, h5, h6 {
            page-break-after: avoid !important;
            break-after: avoid !important;
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* General layout fixes */
        .print-section {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        .print-section-break {
            page-break-before: always !important;
            break-before: always !important;
        }
        
        /* Explicitly allow these to break across pages */
        .print-allow-break {
            page-break-inside: auto !important;
            break-inside: auto !important;
        }
        
        /* Signature section */
        .signature-section {
            page-break-before: always !important;
            break-before: page !important;
            margin-top: 3cm !important;
        }
        .signature-line {
            width: 150px;
            height: 1px;
            background: black;
            margin: 0 auto 8px;
        }
        
        /* Force image rendering */
        img {
			display: block !important;
			max-width: 100% !important;
			width: auto !important;
			height: auto !important;
			page-break-inside: avoid !important;
			break-inside: avoid !important;
		}
    }

    /* Screen-specific adjustments for print mode */
    .print-mode #app-container {
        display: none !important;
    }
    .print-mode #print-container {
        display: block !important;
        position: fixed !important;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        z-index: 9999;
        overflow: auto;
        padding: 0.5cm !important;
    }
    /* Ensure Back to Editor button is styled */
    .print-back-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        background-color: #FFD700;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .print-mode .print-back-btn {
        display: block !important; /* Ensure visibility in print mode */
    }
	.shadow-custom {
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
	  }
	  
	 /* Custom slider styles */
	input[type="range"] {
		-webkit-appearance: none; /* Remove default styling */
		appearance: none;
		width: 100%;
		height: 8px; /* Slightly thicker track */
		background: rgba(255, 215, 0, 0.2); /* bg-primary/20 */
		border-radius: 9999px; /* rounded-full */
		outline: none;
		transition: box-shadow 0.2s ease; /* Smooth transition for hover */
	}

	input[type="range"]:hover {
		box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); /* hover:shadow-md equivalent with primary color glow */
	}

	input[type="range"]::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 16px;
		height: 16px;
		background: #FFD700; /* bg-primary */
		border-radius: 50%; /* rounded-full */
		cursor: pointer;
		border: none;
	}

	input[type="range"]::-moz-range-thumb {
		width: 16px;
		height: 16px;
		background: #FFD700; /* bg-primary */
		border-radius: 50%;
		cursor: pointer;
		border: none;
	}

	input[type="range"]::-ms-thumb {
		width: 16px;
		height: 16px;
		background: #FFD700; /* bg-primary */
		border-radius: 50%;
		cursor: pointer;
		border: none;
	}
		
	.progress-fill {
        animation: progress 1s ease-in-out;
    }
	.status-icon {
		display: inline-block;
		width: 1em;
		text-align: center;
		color: #ef4444; /* Red for incomplete */
	}
	.status-icon.completed {
		color: #10b981; /* Green for complete */
	}
	.collapsible-header {
		cursor: pointer;
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 0.5rem 1rem;
		background-color: #f9fafb;
		border-radius: 0.5rem;
		transition: background-color 0.2s ease;
	}
	.collapsible-header:hover {
		background-color: #e5e7eb;
	}
	.collapsible-content {
		display: none;
		padding: 1rem;
	}
	.collapsible-content.active {
		display: block;
	}
	.toggle-icon::before {
		content: '+';
		font-size: 1.25rem;
		color: #FFD700;
	}
	.collapsible-header.active .toggle-icon::before {
		content: '−';
	}
	.required-field {
		border-color: #ef4444; /* Red border for empty required fields */
	}
	.required-field.valid {
		border-color: #10b981; /* Green border when filled */
	}
	.disabled-btn {
		background-color: #6b7280; /* Tailwind's gray-500 */
		color: #d1d5db; /* Tailwind's gray-300 */
		cursor: not-allowed;
		opacity: 1; /* Remove the opacity fade */
	}
    @keyframes progress {
        from { width: 0%; }
        to { width: var(--progress-width); }
    }
    .border:hover {
        transform: translateY(-2px);
        transition: transform 0.2s ease;
    }
	.dark .text-gray-600 {
	  color: #d1d5db; /* Tailwind's text-gray-300 */
	}
	.dark .text-gray-500 {
	  color: #9ca3af; /* Tailwind's text-gray-400 */
	}
	.dark input::placeholder,
	.dark textarea::placeholder {
	  color: #d1d5db; /* Matches text-gray-300 */
	}

	.dark .collapsible-content .border {
	  border-color: #4b5563; /* Tailwind's gray-600 for better visibility */

	}
	.dark #progress-tracker .collapsible-header {
		background-color: #374151 !important; /* Tailwind's gray-800 */
	}
	.dark #progress-tracker .collapsible-header:hover {
		background-color: #4b5563 !important; /* Tailwind's gray-700 */
	}
	.dark .collapsible-header {
		background-color: #374151 !important;
	}
	.dark .collapsible-header:hover {
		background-color: #4b5563 !important;
	}
	/* Change the font color of collapsible header text to gold in dark mode */
	.dark .collapsible-header h2,
	.dark .collapsible-header h3 {
		color: #FFD700;
	}
	/* Ensure the collapsible header in dark mode has the correct background */
	.dark #progress-tracker .collapsible-header {
		background-color: #374151; /* Tailwind's gray-800 */
	}
	.dark #progress-tracker .collapsible-header:hover {
		background-color: #4b5563; /* Tailwind's gray-700 */
	}
	/* Progress Bar Styles */
	.progress-bar-container {
		width: 100%;
	}
	.progress-bar {
		width: 100%;
		background: #e0e0e0;
		height: 10px;
		border-radius: 5px;
		overflow: hidden;
	}
	.progress-bar-fill {
		height: 100%;
		background: #FFD700; /* Primary color (gold) */
		transition: width 0.3s ease;
	}
	/* Progress Item Styles */
	.progress-item {
		display: flex;
		align-items: center;
		padding: 8px;
		border-radius: 5px;
		font-family: 'Poppins', sans-serif;
		font-size: 14px;
	}
	/* Ensure progress bar is always visible */
	.progress-bar-container {
		padding: 0 1rem; /* Match the padding of collapsible-header */
	}

	/* Adjust padding for progress details when expanded */
	#progress-details {
		padding: 0; /* Remove extra padding since progress-item has its own padding */
	}
	.progress-icon {
		font-size: 18px;
	}
	/* Adjust background for Form Progress section in dark mode */
	.dark #progress-tracker {
		background-color: #1f2937; /* Tailwind's gray-900 */
	}

	/* Adjust background for progress items in dark mode */
	.dark .progress-item {
		background-color: #374151; /* Tailwind's gray-800 */
	}
	/* Icon States */
	.progress-icon.not-started {
		color: #ccc; /* Gray for not started */
	}
	.progress-icon.in-progress {
		color: #f59e0b; /* Amber for in progress */
	}
	.progress-icon.completed {
		color: #10b981; /* Green for completed */
	}
	#generate-btn:not(.disabled-btn) {
		transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
	}

	#generate-btn:not(.disabled-btn):hover {
		background-color: #E6C200; /* Tailwind's secondary */
		transform: scale(1.05); /* Slight scale-up effect */
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
	}
    </style>
    

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFD700',
                        secondary: '#E6C200',
						accent: '#2D3748',
                        textPrimary: '#1A1A1A'
                    },
                    fontFamily: {
					  sans: ['Poppins', 'Helvetica', 'Arial', 'sans-serif'],
					}
									}
            },
            darkMode: 'class'
        }
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            document.documentElement.classList.toggle('dark', event.matches);
        });
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Main App Container -->
    <div id="app-container" class="container mx-auto px-4 py-6 max-w-5xl">
		<header class="text-center mb-8">
			<div class="flex justify-between items-center">
				<h1 class="text-3xl font-bold text-primary bg-gradient-to-r from-primary to-secondary text-transparent bg-clip-text">
					Lee Man Youth Academy Player Review Generator
				</h1>
				<a href="https://melvinlhchow.github.io/LMPlayerReport/readme.html" target="_blank" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors">View README</a>
			</div>
			<p class="text-gray-600 dark:text-gray-300 dark:text-gray-400">Create comprehensive player review reports for your academy players</p>
		</header>
		<div id="progress-tracker" class="mb-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg shadow-custom">
			<!-- Collapsible Header -->
			<div class="collapsible-header" data-section="progress">
				<h2 class="text-lg font-semibold text-primary">Form Progress</h2>
				<span class="toggle-icon"></span>
			</div>
			<!-- Progress Bar (Always Visible) -->
			<div class="progress-bar-container mb-4">
				<div class="progress-bar">
					<div id="progress-bar-fill" class="progress-bar-fill" style="width: 0%;"></div>
				</div>
				<div class="text-sm text-gray-600 dark:text-gray-300 mt-1">
					<span id="progress-percentage">0%</span> Complete
				</div>
			</div>
			<!-- Collapsible Content (Hidden by Default) -->
			<div class="collapsible-content" id="progress-details">
				<div class="space-y-2">
					<div class="progress-item flex items-center p-2 rounded-md bg-white dark:bg-gray-700">
						<span class="progress-icon mr-2" id="icon-player">⏳</span>
						<span>Player Data</span>
						<span class="ml-auto text-sm text-gray-600 dark:text-gray-300" id="progress-player">Not Started</span>
					</div>
					<div class="progress-item flex items-center p-2 rounded-md bg-white dark:bg-gray-700">
						<span class="progress-icon mr-2" id="icon-height">⏳</span>
						<span>Height Growth</span>
						<span class="ml-auto text-sm text-gray-600 dark:text-gray-300" id="progress-height">Not Started</span>
					</div>
					<div class="progress-item flex items-center p-2 rounded-md bg-white dark:bg-gray-700">
						<span class="progress-icon mr-2" id="icon-attendance">⏳</span>
						<span>Attendance</span>
						<span class="ml-auto text-sm text-gray-600 dark:text-gray-300" id="progress-attendance">Not Started</span>
					</div>
					<div class="progress-item flex items-center p-2 rounded-md bg-white dark:bg-gray-700">
						<span class="progress-icon mr-2" id="icon-ratings">⏳</span>
						<span>Performance Ratings</span>
						<span class="ml-auto text-sm text-gray-600 dark:text-gray-300" id="progress-ratings">Not Started</span>
					</div>
					<div class="progress-item flex items-center p-2 rounded-md bg-white dark:bg-gray-700">
						<span class="progress-icon mr-2" id="icon-grades">⏳</span>
						<span>Grades</span>
						<span class="ml-auto text-sm text-gray-600 dark:text-gray-300" id="progress-grades">Not Started</span>
					</div>
					<div class="progress-item flex items-center p-2 rounded-md bg-white dark:bg-gray-700">
						<span class="progress-icon mr-2" id="icon-feedback">⏳</span>
						<span>Feedback</span>
						<span class="ml-auto text-sm text-gray-600 dark:text-gray-300" id="progress-feedback">Not Started</span>
					</div>
					<div class="progress-item flex items-center p-2 rounded-md bg-white dark:bg-gray-700">
						<span class="progress-icon mr-2" id="icon-signatures">⏳</span>
						<span>Signatures</span>
						<span class="ml-auto text-sm text-gray-600 dark:text-gray-300" id="progress-signatures">Not Started</span>
					</div>
				</div>
			</div>
		</div>
		
		<div id="status-message" class="mt-6 py-2 px-4 rounded-md hidden"></div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
           
			<!-- Input Section -->
            <div class="bg-gray-50 dark:bg-gray-800 p-8 rounded-lg shadow-custom border border-gradient-to-r from-primary to-secondary">
				<div class="collapsible-section">
				<div class="collapsible-header" data-section="player">
					<h2 class="text-xl font-semibold text-primary">Player Data Input</h2>
					<span class="toggle-icon"></span>
				</div>
				<div class="collapsible-content">
                
                <!-- Player Data Input Method Toggle -->
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Data Input Method</label>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="player-input-method" value="manual" checked class="text-primary focus:ring-primary" id="manual-player-data">
                            <span class="ml-2">Manual Input</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="player-input-method" value="file" class="text-primary focus:ring-primary" id="file-player-data">
                            <span class="ml-2">Upload File</span>
                        </label>
                    </div>
                </div>
                
				
				<div id="player-file-input" class="mb-6 space-y-4 hidden">
                <!-- File Upload Section -->
				
					<div>
						<label class="block text-sm font-medium mb-1" for="xlsFile">Upload Player Data (XLS/XLSX)</label>
						<input type="file" id="xlsFile" accept=".xls,.xlsx" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer" />
						<div class="mt-2">
							<a href="https://melvinlhchow.github.io/LMPlayerReport/player_data_template.xlsx" 
							   download="player_data_template.xlsx" 
							   class="inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors">
								<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
								</svg>
								Download Excel Template
							</a>
						</div>
						<p class="mt-1 text-xs text-gray-500 dark:text-gray-300">Please use the provided template for data input to ensure compatibility.</p>
					</div>
					<div id="playerSelectContainer" class="hidden">
						<label class="block text-sm font-medium mb-1" for="playerSelect">Select Player</label>
						<select id="playerSelect" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700">
							<option value="">Select a player...</option>
						</select>
					</div>
				</div>
								
                <!-- Manual Player Data Input -->
                <div id="player-manual-input" class="mb-6 space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>                           
							<label for="manual-first-name" class="block text-sm font-medium mb-1">First Name<span class="text-red-400 text-xs">*</span></label>
							<input type="text" id="manual-first-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 required-field" placeholder="Enter first name">
						</div>
                        <div>
                            <label for="manual-last-name" class="block text-sm font-medium mb-1">Last Name<span class="text-red-400 text-xs">*</span></label>
							<input type="text" id="manual-last-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 required-field" placeholder="Enter last name">
						</div>
                    </div>
                    <div>
                        <label for="manual-dob" class="block text-sm font-medium mb-1">Date of Birth</label>
                        <input type="date" id="manual-dob" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400">
                    </div>
                    <div>
                        <label for="manual-position" class="block text-sm font-medium mb-1">Position</label>
                        <input type="text" id="manual-position" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400" placeholder="Enter player position">
                    </div>
                </div>
                
				<div>
					<label class="block text-sm font-medium mb-1" for="portraitFile">Upload Player Portrait <span class="text-red-400 text-xs">*</span></label>
					<input type="file" id="portraitFile" accept="image/jpeg,image/png" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer hover:border-primary focus:ring-2 focus:ring-primary required-field" />
				</div>
                
                <!-- Club Logo Upload (Optional) -->
                <div class="mt-4">
                    <label class="block text-sm font-medium mb-1" for="clubLogoFile">Upload Club Logo (Optional)</label>
                    <input type="file" id="clubLogoFile" accept="image/jpeg,image/png,image/svg+xml" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer" />
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-300">If not provided, a default club logo will be used.</p>
                </div>
				</div></div>

				<!-- Height Growth Data Section -->
				<div class="collapsible-section mt-6">
					<div class="collapsible-header" data-section="height">
						<h3 class="font-medium text-lg">Height Growth Data</h3>
						 <span class="toggle-icon"></span>
					 </div>
					  <div class="collapsible-content" id="height-growth-section">
							<div class="bg-white dark:bg-gray-800 p-4 rounded-md mb-4 border">
							<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
								<div>
									<label for="height-start-month" class="block text-sm font-medium mb-1">Start Month</label>
									
									<select id="height-start-month" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 hover:border-primary focus:ring-2 focus:ring-primary">
										<option value="0">January</option>
										<option value="1">February</option>
										<option value="2">March</option>
										<option value="3">April</option>
										<option value="4">May</option>
										<option value="5">June</option>
										<option value="6">July</option>
										<option value="7">August</option>
										<option value="8">September</option>
										<option value="9">October</option>
										<option value="10">November</option>
										<option value="11">December</option>
									</select>
								</div>
								<div>
									<label for="height-end-month" class="block text-sm font-medium mb-1">End Month</label>
									<select id="height-end-month" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700">
										<option value="0">January</option>
										<option value="1">February</option>
										<option value="2">March</option>
										<option value="3">April</option>
										<option value="4">May</option>
										<option value="5" selected>June</option>
										<option value="6">July</option>
										<option value="7">August</option>
										<option value="8">September</option>
										<option value="9">October</option>
										<option value="10">November</option>
										<option value="11">December</option>
									</select>
								</div>
								<div>
									<label for="height-year" class="block text-sm font-medium mb-1">Year</label>
									<select id="height-year" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700">
										<!-- Years will be dynamically populated -->
									</select>
								</div>
							</div>
							<p class="mb-4 text-xs text-gray-500 dark:text-gray-300">Select the start and end months, and the year for the height tracking period.</p>
							<div id="height-growth-inputs" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
								<!-- Month inputs will be dynamically generated -->
							</div>
						</div>
					</div>
				</div>





                <!-- Attendance Data Section -->
				<div class="collapsible-section mt-6">
					<div class="collapsible-header" data-section="attendance">
                        <h3 class="font-medium text-lg">Attendance Data</h3>
                             <span class="toggle-icon"></span>
                    </div>
					<div class="collapsible-content" id="attendance-section">
                    
					<div class="bg-white dark:bg-gray-800 p-4 rounded-md mb-4 border">
						<div class="mb-4">
							<label class="block text-sm font-medium mb-1">Data Input Method</label>
							<div class="flex space-x-4">
								<label class="inline-flex items-center">
									<input type="radio" name="attendance-input-method" value="manual" checked class="text-primary focus:ring-primary" id="manual-attendance">
									<span class="ml-2">Manual Input</span>
								</label>
								<label class="inline-flex items-center">
									<input type="radio" name="attendance-input-method" value="file" class="text-primary focus:ring-primary" id="file-attendance">
									<span class="ml-2">Upload File</span>
								</label>
							</div>
						</div>
						<div id="attendance-file-input" class="hidden mb-4">
							<label class="block text-sm font-medium mb-1" for="attendanceFile">Upload Attendance Data (XLS/XLSX)</label>
							<input type="file" id="attendanceFile" accept=".xls,.xlsx" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary cursor-pointer" />
							<p class="mt-1 text-xs text-gray-500 dark:text-gray-300">File should include training and match attendance data.</p>
						</div>
						<div id="attendance-manual-input">
							<div class="mb-4">
								<h4 class="font-medium text-md mb-2">Training Attendance</h4>
								<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
									<div>
										<label class="block text-sm mb-1" for="total-training-sessions">Total Sessions</label>
										<input type="number" min="0" id="total-training-sessions" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base hover:border-primary focus:ring-2 focus:ring-primary" value="0">
									</div>
									<div>
										<label class="block text-sm mb-1" for="training-sessions-attended">Sessions Attended</label>
										<input type="number" min="0" id="training-sessions-attended" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base hover:border-primary focus:ring-2 focus:ring-primary" value="0">
									</div>
									<div>
										<label class="block text-sm mb-1" for="total-training-minutes">Total Minutes</label>
										<input type="number" min="0" id="total-training-minutes" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base hover:border-primary focus:ring-2 focus:ring-primary" value="0">
									</div>
								</div>
							</div>
							<div>
								<h4 class="font-medium text-md mb-2">Match Clock</h4>
								<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
									<div>
										<label class="block text-sm mb-1" for="total-matches">Total Matches</label>
										<input type="number" min="0" id="total-matches" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base hover:border-primary focus:ring-2 focus:ring-primary" value="0">
									</div>
									<div>
										<label class="block text-sm mb-1" for="matches-played">Matches Played</label>
										<input type="number" min="0" id="matches-played" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base hover:border-primary focus:ring-2 focus:ring-primary" value="0">
									</div>
									<div>
										<label class="block text-sm mb-1" for="total-match-minutes">Total Match Minutes</label>
										<input type="number" min="0" id="total-match-minutes" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base hover:border-primary focus:ring-2 focus:ring-primary" value="0">
									</div>
									<div>
										<label class="block text-sm mb-1" for="match-minutes-played">Match Minutes Played</label>
										<input type="number" min="0" id="match-minutes-played" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-600 text-base hover:border-primary focus:ring-2 focus:ring-primary" value="0">
									</div>
								</div>
							</div>
						</div>
					</div>
					
					</div>
                </div>
                
                <!-- Rating Sliders -->
				<div class="collapsible-section mt-6">
					<div class="collapsible-header" data-section="ratings">
						<h3 class="font-medium text-lg text-primary">Performance Ratings</h3>
						<span class="toggle-icon"></span>
					</div>
					<div class="collapsible-content">
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2 text-primary">1. Game Intelligence</h4>
						<p class="text-xs text-gray-500 mt-1">1 = Poor, 5 = Excellent</p>
                        <div class="space-y-3">
							<div>
								<label class="block text-sm mb-1" for="movement-to-receive">Movement to Receive</label>
								<div class="flex items-center">
									<input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="movement-to-receive">
									<span class="ml-2 min-w-[20px] text-center" id="movement-to-receive-value">3</span>
								</div>
							</div>
                            <div>
                                <label class="block text-sm mb-1" for="actions-to-create">Actions to Create</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="actions-to-create">
                                    <span class="ml-2 min-w-[20px] text-center" id="actions-to-create-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="actions-to-disrupt">Actions to Disrupt</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="actions-to-disrupt">
                                    <span class="ml-2 min-w-[20px] text-center" id="actions-to-disrupt-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2 text-green-600">2. Technical Ability</h4>
						<p class="text-xs text-gray-500 mt-1">1 = Poor, 5 = Excellent</p>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1" for="with-balance">With Balance</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="with-balance">
                                    <span class="ml-2 min-w-[20px] text-center" id="with-balance-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="with-speed">With Speed</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="with-speed">
                                    <span class="ml-2 min-w-[20px] text-center" id="with-speed-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="execution">Execution</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="execution">
                                    <span class="ml-2 min-w-[20px] text-center" id="execution-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2 text-red-600">3. Physical Capacity</h4>
						<p class="text-xs text-gray-500 mt-1">1 = Poor, 5 = Excellent</p>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1" for="speed">Speed</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="speed">
                                    <span class="ml-2 min-w-[20px] text-center" id="speed-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="aggressive">Aggressive</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="aggressive">
                                    <span class="ml-2 min-w-[20px] text-center" id="aggressive-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="dominant">Dominant</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="dominant">
                                    <span class="ml-2 min-w-[20px] text-center" id="dominant-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-medium text-md mb-2 text-purple-600">4. Social Competence</h4>
						<p class="text-xs text-gray-500 mt-1">1 = Poor, 5 = Excellent</p>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1" for="communication">Communication</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="communication">
                                    <span class="ml-2 min-w-[20px] text-center" id="communication-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="demanding">Demanding</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="demanding">
                                    <span class="ml-2 min-w-[20px] text-center" id="demanding-value">3</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1" for="confidence">Confidence</label>
                                <div class="flex items-center">
                                    <input type="range" min="1" max="5" step="1" value="3" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600" id="confidence">
                                    <span class="ml-2 min-w-[20px] text-center" id="confidence-value">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div></div>
                
                <!-- Grade Selection -->
                <div class="collapsible-section mt-6">
					<div class="collapsible-header" data-section="grades">
						<h3 class="font-medium text-lg text-primary">Player Grades</h3>
						<span class="toggle-icon"></span>
					</div>
					<div class="collapsible-content">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="current-grade" class="block text-sm font-medium mb-1">Current Grade</label>
                            <select id="current-grade" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base">
                                <option value="A" selected>A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                        <div>
                            <label for="target-grade" class="block text-sm font-medium mb-1">Target Grade</label>
                            <select id="target-grade" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base">
                                <option value="A" selected>A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                    </div>
                </div></div>

                <!-- Feedback Section -->
                <div class="collapsible-section mt-6">
					<div class="collapsible-header" data-section="feedback">
						<h3 class="font-medium text-lg text-primary">Feedback</h3>
						<span class="toggle-icon"></span>
					</div>
					<div class="collapsible-content">
					<div class="mb-6 space-y-4">
                    <div>
                        <label for="targeted-feedback" class="block text-sm font-medium mb-1">Targeted Feedback</label>
                        <textarea id="targeted-feedback" rows="4" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Provide specific targeted feedback for the player..."></textarea>			
						</div>
                    <div>
                        <label for="areas-improvement" class="block text-sm font-medium mb-1">Areas of Improvement</label>
                        <textarea id="areas-improvement" rows="4" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Identify key areas for improvement..."></textarea>
                    </div>
					</div>
					</div>
				</div>
                
                <!-- Report Signatures Section -->
				<div class="collapsible-section mt-6">
					<div class="collapsible-header" data-section="signatures">
						<h3 class="font-medium text-lg text-primary">Report Sign-off</h3>
						<span class="toggle-icon"></span>
					</div>
					<div class="collapsible-content">
						<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
							<div>
								<label for="coach1-name" class="block text-sm font-medium mb-1">Coach 1 Name</label>
								<input type="text" id="coach1-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Enter coach's name" value="Melvin Chow">
								<label for="coach1-title" class="block text-sm font-medium mb-1 mt-2">Title</label>
								<input type="text" id="coach1-title" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Enter title" value="Coach">
							</div>
							<div>
								<label for="coach2-name" class="block text-sm font-medium mb-1">Coach 2 Name</label>
								<input type="text" id="coach2-name" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Enter coach's name" value="Lee Hong Lim">
								<label for="coach2-title" class="block text-sm font-medium mb-1 mt-2">Title</label>
								<input type="text" id="coach2-title" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Enter title" value="Coach">
							</div>
							<div>
								<label for="technical-director" class="block text-sm font-medium mb-1">Technical Director</label>
								<input type="text" id="technical-director" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Enter technical director's name" value="Darren Bowman">
								<label for="technical-director-title" class="block text-sm font-medium mb-1 mt-2">Title</label>
								<input type="text" id="technical-director-title" class="w-full rounded-md border-gray-300 shadow-sm p-2 bg-white dark:bg-gray-700 text-base placeholder-gray-400 hover:border-primary focus:ring-2 focus:ring-primary" placeholder="Enter title" value="Technical Director">
							</div>
						</div>
					</div>
                </div>
                
                <div class="flex justify-between mt-8">
                    
					<button id="generate-btn" class="px-6 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors flex items-center disabled-btn" disabled>
						<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
						Generate Report
					</button>
					<button id="reset-btn" class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors flex items-center">
						<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5m11 11v-5h-5m-6 0l6-6m-6 6l6-6"></path></svg>
						Reset Form
					</button>				
									
				</div>
            </div>

            <!-- Preview Section -->
            <div>
                <div class="bg-gray-50 dark:bg-gray-800 p-8 rounded-lg shadow-custom mb-6">
                    <h2 class="text-xl font-semibold mb-4 text-primary">Report Preview</h2>
					<div id="report-preview" class="bg-gradient-to-br from-gray-50 to-white dark:bg-gradient-to-br dark:from-gray-800 dark:to-gray-700 p-4 rounded-md min-h-[200px] overflow-auto">
						<div class="text-center text-gray-500 dark:text-gray-300 py-12">Your report preview will appear here.</div>
					</div>
                    <div id="pdf-controls" class="mt-4 text-center hidden">
                        <div class="flex justify-center space-x-4">
                            <button id="print-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2z" />
                                </svg>
                                Print Report
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 dark:text-gray-400 mt-2">Opens a new window with the report for printing or saving as PDF</p>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-800 p-8 rounded-lg shadow-custom">
                    <h2 class="text-xl font-semibold mb-4 text-primary">Instructions</h2>
                    <div class="space-y-3 text-sm">
                        <p>1. Enter player information manually or upload from a file</p>
                        <p>2. Upload the player's portrait photo</p>
                        <p>3. Upload the club logo (optional)</p>
                        <p>4. Rate the player on all 12 performance metrics</p>
                        <p>5. Add detailed feedback and improvement areas</p>
                        <p>6. Click 'Generate Report' to preview</p>
                        <p>7. Use the 'Print Report' button to open a printable version</p>
                        <p>8. In the print dialog, select "Save as PDF" to download</p>
                        <p class="text-primary font-medium">Note: Player data is only used for the current session and isn't saved between sessions.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-800 p-8 rounded-lg shadow-custom mt-6">
			<h2 class="text-xl font-semibold mb-4 text-primary">Saved Reports</h2>
			<div class="flex justify-between items-center">
					<button id="download-session-btn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center">
						<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19V5m0 14l-4-4m4 4l4-4m-8 4h8"></path></svg>
						Download All Saved Data
					</button>
				
				</div>
			<div id="saved-reports-list" class="space-y-2">
				<p class="text-gray-500 dark:text-gray-300">No reports saved yet.</p>
			</div>
		</div>
        
        

    <!-- Print Container -->
    <div id="print-container" class="text-black">
        <!-- Report content will be added here when printing -->
        <button id="back-to-editor-btn" class="print-back-btn no-print hidden">Back to Editor</button>
    </div>

		<script>
		// Default club logo as a URL to the hosted PNG
		const defaultClubLogoSVG = 'https://melvinlhchow.github.io/LMPlayerReport/LMLogo.png';

		// Global variables
		let clubLogoData = null;
		let currentReportHTML = "";
		let playersData = [];
		let selectedPlayerData = null;
		let portraitImageData = null;
		let currentAttendanceData = null;
		let savedReports = [];
		let currentHeightGrowthData = [];
		let currentTotalGrowth = 0;
		let hasDownloadedSessionData = false;
		let ratingsLoadedFromFile = false; // Flag to track if ratings were loaded from a file
		let ratingsManuallyChanged = new Set(); // Track which sliders have been manually changed

		// DOM elements (defined globally, initialized in DOMContentLoaded)
		const manualPlayerDataRadio = document.getElementById('manual-player-data');
		const filePlayerDataRadio = document.getElementById('file-player-data');
		const playerFileSection = document.getElementById('player-file-input');
		const playerManualInput = document.getElementById('player-manual-input');
		const xlsFileInput = document.getElementById('xlsFile');
		const portraitFileInput = document.getElementById('portraitFile');
		const clubLogoFileInput = document.getElementById('clubLogoFile');
		const playerSelectContainer = document.getElementById('playerSelectContainer');
		const playerSelect = document.getElementById('playerSelect');
		const generateBtn = document.getElementById('generate-btn');
		const resetBtn = document.getElementById('reset-btn');
		const reportPreview = document.getElementById('report-preview');
		const statusMessage = document.getElementById('status-message');
		const pdfControls = document.getElementById('pdf-controls');
		const printBtn = document.getElementById('print-btn');
		const manualFirstName = document.getElementById('manual-first-name');
		const manualLastName = document.getElementById('manual-last-name');
		const manualDob = document.getElementById('manual-dob');
		const manualPosition = document.getElementById('manual-position');
		const progressBarFill = document.getElementById('progress-bar-fill');
		const progressPercentageText = document.getElementById('progress-percentage');

		// Sliders array
		const sliders = [
			'movement-to-receive', 'actions-to-create', 'actions-to-disrupt',
			'with-balance', 'with-speed', 'execution',
			'speed', 'aggressive', 'dominant',
			'communication', 'demanding', 'confidence'
		];

		// Function definitions (moved above DOMContentLoaded)
		function formatExcelDate(serial) {
			if (!serial || isNaN(serial)) return 'N/A';
			const excelEpoch = new Date(Date.UTC(1899, 11, 31));
			const days = Math.floor(serial);
			const milliseconds = Math.round((serial - days) * 86400000);
			const date = new Date(excelEpoch.getTime() + (days * 86400000) + milliseconds);
			if (serial < 60) {
				date.setUTCDate(date.getUTCDate() - 1);
			}
			return date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
		}

		function getMonthIndex(monthName) {
			if (!monthName) return -1;
			const monthMap = {
				'jan': 0, 'january': 0,
				'feb': 1, 'february': 1,
				'mar': 2, 'march': 2,
				'apr': 3, 'april': 3,
				'may': 4, 'may': 4,
				'jun': 5, 'june': 5,
				'jul': 6, 'july': 6,
				'aug': 7, 'august': 7,
				'sep': 8, 'september': 8,
				'oct': 9, 'october': 9,
				'nov': 10, 'november': 10,
				'dec': 11, 'december': 11
			};
			return monthMap[monthName.toLowerCase()] ?? -1;
		}

		function togglePlayerInput() {
			if (manualPlayerDataRadio.checked) {
				playerManualInput.classList.remove('hidden');
				playerFileSection.classList.add('hidden');
				playerSelectContainer.classList.add('hidden');
			} else {
				playerManualInput.classList.add('hidden');
				playerFileSection.classList.remove('hidden');
				playerSelectContainer.classList.remove('hidden');
			}
			updateGenerateButtonState();
			updateProgress();
		}

		function handleFileUpload(e) {
			const file = e.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = (e) => {
					const data = new Uint8Array(e.target.result);
					const workbook = XLSX.read(data, { type: 'array' });
					const sheetName = workbook.SheetNames[0];
					const worksheet = workbook.Sheets[sheetName];
					playersData = XLSX.utils.sheet_to_json(worksheet);
					populatePlayerSelect();
					showStatus('Player data file uploaded successfully!', 'success');
				};
				reader.readAsArrayBuffer(file);
			}
		}

		function handleClubLogoUpload(e) {
			const file = e.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = (e) => {
					clubLogoData = e.target.result;
					showStatus('Club logo uploaded successfully!', 'success');
				};
				reader.readAsDataURL(file);
			}
		}

		function populatePlayerSelect() {
			playerSelect.innerHTML = '<option value="">Select a player...</option>';
			playersData.forEach((player, index) => {
				const option = document.createElement('option');
				option.value = index;
				option.textContent = `${player['First Name'] || ''} ${player['Last Name'] || ''}`.trim() || 'Unnamed Player';
				playerSelect.appendChild(option);
			});
		}


		// Add this function before populateHeightInputs
		function updateHeightGrowthData() {
			const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
			currentHeightGrowthData = [];
			currentTotalGrowth = 0;
			const inputs = document.querySelectorAll('#height-growth-inputs input[type="number"]');
			let previousHeight = null;

			inputs.forEach(input => {
				const [_, monthStr, yearStr] = input.id.split('-'); // e.g., 'height-dec-2024'
				const month = months.findIndex(m => m.toLowerCase().startsWith(monthStr));
				const year = parseInt(yearStr);
				const height = parseFloat(input.value) || 0;
				currentHeightGrowthData.push({ month, year, height: height || '' });

				if (height) {
					if (previousHeight !== null) {
						currentTotalGrowth += height - previousHeight;
					}
					previousHeight = height;
				}
			});

			currentTotalGrowth = parseFloat(currentTotalGrowth.toFixed(1));
		}

		function populateHeightInputs() {
			let startMonth = parseInt(document.getElementById('height-start-month').value);
			let endMonth = parseInt(document.getElementById('height-end-month').value);
			let startYear = parseInt(document.getElementById('height-year').value);
			const heightInputsContainer = document.getElementById('height-growth-inputs');
			const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

			console.log('populateHeightInputs called with:', { startMonth, endMonth, startYear });

			// Validate inputs
			if (isNaN(startMonth) || isNaN(endMonth) || isNaN(startYear)) {
				console.error('Invalid input values, using defaults:', { startMonth, endMonth, startYear });
				startMonth = isNaN(startMonth) ? 0 : startMonth; // Default to January
				endMonth = isNaN(endMonth) ? 5 : endMonth; // Default to June
				startYear = isNaN(startYear) ? new Date().getFullYear() : startYear; // Default to current year
			}

			heightInputsContainer.innerHTML = ''; // Clear existing inputs
			currentHeightGrowthData = [];

			let currentMonth = startMonth;
			let currentYear = startYear;
			let wrapped = false;

			// Determine if the end month is in the next year
			if (endMonth < startMonth) {
				wrapped = true; // Cross-year scenario
			}

			let iterationCount = 0;
			const maxIterations = 24; // Maximum of 2 years to prevent infinite loops
			while (true) {
				if (iterationCount > maxIterations) {
					console.error('Maximum iterations exceeded in populateHeightInputs');
					break;
				}
				iterationCount++;

				console.log(`Processing: ${months[currentMonth]} ${currentYear}`);

				const monthName = months[currentMonth];
				const displayLabel = `${monthName} ${currentYear}`; // Show year in the label
				const inputDiv = document.createElement('div');
				inputDiv.className = 'mb-4';
				inputDiv.innerHTML = `
					<label class="block text-sm font-medium mb-1">${displayLabel}</label>
					<input type="number" step="0.1" class="height-input w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-600" data-month="${currentMonth}" data-year="${currentYear}">
				`;
				heightInputsContainer.appendChild(inputDiv);
				currentHeightGrowthData.push({ month: currentMonth, year: currentYear, height: '' });

				if (currentMonth === endMonth && (wrapped ? currentYear === startYear + 1 : currentYear === startYear)) {
					console.log('Break condition met, exiting loop');
					break;
				}

				currentMonth = (currentMonth + 1) % 12;
				if (currentMonth === 0) { // Always increment the year when wrapping from Dec to Jan
					console.log('Wrapping from Dec to Jan, incrementing year');
					currentYear += 1;
				}
			}

			console.log('Loop exited, currentHeightGrowthData:', currentHeightGrowthData);

			// Populate height inputs with data
			document.querySelectorAll('.height-input').forEach(input => {
				const month = parseInt(input.dataset.month);
				const year = parseInt(input.dataset.year);
				const monthName = months[month];
				// Adjust height key to include year if necessary
				const heightKey = year === startYear ? `${monthName} Height` : `${monthName} Height ${year}`;
				const heightValue = selectedPlayerData && selectedPlayerData[heightKey] ? selectedPlayerData[heightKey] : (selectedPlayerData && selectedPlayerData[`${monthName} Height`] ? selectedPlayerData[`${monthName} Height`] : '');
				input.value = heightValue;
				const entry = currentHeightGrowthData.find(e => e.month === month && e.year === year);
				if (entry) entry.height = heightValue;
			});

			console.log('Height inputs populated');
		}
		
		
		function populateYears() {
			const yearSelect = document.getElementById('height-year');
			const currentYear = new Date().getFullYear();
			const startYear = currentYear - 5; // 5 years in the past
			const endYear = currentYear + 1;   // 1 year in the future

			yearSelect.innerHTML = ''; // Clear existing options
			for (let year = startYear; year <= endYear; year++) {
				const option = document.createElement('option');
				option.value = year;
				option.textContent = year;
				if (year === currentYear) {
					option.selected = true; // Set current year as default
				}
				yearSelect.appendChild(option);
			}
		}

		function updateGenerateButtonState() {
			const portraitFile = document.getElementById('portraitFile').value;
			const firstName = document.getElementById('manual-first-name').value.trim();
			const lastName = document.getElementById('manual-last-name').value.trim();

			let isValid = true;

			if (manualPlayerDataRadio.checked) {
				if (!firstName || !lastName || !portraitFile) {
					isValid = false;
				}
			} else {
				if (!playerSelect.value || !portraitFile) {
					isValid = false;
				}
			}

			generateBtn.disabled = !isValid;
			generateBtn.classList.toggle('disabled-btn', !isValid);
		}
		
		function toggleSection(header) {
			// Find the parent container of the header
			const parent = header.parentElement;
			// Find the .collapsible-content within the parent
			const content = parent.querySelector('.collapsible-content');
			if (content) {
				const isActive = content.classList.toggle('active');
				header.classList.toggle('active', isActive);
			}
		}

		function updateProgress() {
			let totalSections = 7; // Player Data, Height Growth, Attendance, Ratings, graders, Feedback, Signatures
			let completedSections = 0;

			// Player Data Progress
			let playerProgress = 'Not Started';
			const firstName = manualFirstName.value.trim();
			const lastName = manualLastName.value.trim();
			if (filePlayerDataRadio.checked) {
				if (playerSelect.value) {
					playerProgress = 'Completed';
					completedSections++;
				}
			} else {
				if (firstName && lastName && portraitImageData) {
					playerProgress = 'Completed';
					completedSections++;
				} else if (firstName || lastName || portraitImageData) {
					playerProgress = 'In Progress';
				}
			}
			document.getElementById('progress-player').textContent = playerProgress;
			document.getElementById('icon-player').className = `progress-icon ${playerProgress.toLowerCase().replace(' ', '-')}`;

			// Height Growth Progress
			let heightProgress = 'Not Started';
			const heightInputs = document.querySelectorAll('.height-input');
			const filledHeightInputs = Array.from(heightInputs).filter(input => input.value.trim() !== '');
			console.log(`Height Inputs: ${heightInputs.length} Filled: ${filledHeightInputs.length} Values: [${Array.from(heightInputs).map(input => `"${input.value}"`).join(', ')}]`); // Debugging
			if (filledHeightInputs.length > 0) {
				heightProgress = 'Completed';
				completedSections++;
			} else {
				heightProgress = 'Not Started';
			}
			document.getElementById('progress-height').textContent = heightProgress;
			document.getElementById('icon-height').className = `progress-icon ${heightProgress.toLowerCase().replace(' ', '-')}`;

			// Attendance Progress
			let attendanceProgress = 'Not Started';
			const attendanceInputs = document.querySelectorAll('#attendance-manual-input input[type="number"]');
			const filledAttendanceInputs = Array.from(attendanceInputs).filter(input => parseInt(input.value) > 0);
			if (filledAttendanceInputs.length === attendanceInputs.length) {
				attendanceProgress = 'Completed';
				completedSections++;
			} else if (filledAttendanceInputs.length > 0) {
				attendanceProgress = 'In Progress';
			}
			document.getElementById('progress-attendance').textContent = attendanceProgress;
			document.getElementById('icon-attendance').className = `progress-icon ${attendanceProgress.toLowerCase().replace(' ', '-')}`;

			
			// Ratings Progress
			let ratingsProgress = 'Not Started';
			if (ratingsLoadedFromFile || ratingsManuallyChanged.size === sliders.length) {
				ratingsProgress = 'Completed';
				completedSections++;
			} else if (ratingsManuallyChanged.size > 0) {
				ratingsProgress = 'In Progress';
			}
			document.getElementById('progress-ratings').textContent = ratingsProgress;
			document.getElementById('icon-ratings').className = `progress-icon ${ratingsProgress.toLowerCase().replace(' ', '-')}`;	
						
			// Grades Progress
			let gradesProgress = 'Not Started';
			const currentGrade = document.getElementById('current-grade').value;
			const targetGrade = document.getElementById('target-grade').value;
			if (currentGrade !== 'A' || targetGrade !== 'A') { // Assuming 'A' is the default
				gradesProgress = 'Completed';
				completedSections++;
			}
			document.getElementById('progress-grades').textContent = gradesProgress;
			document.getElementById('icon-grades').className = `progress-icon ${gradesProgress.toLowerCase().replace(' ', '-')}`;

			// Feedback Progress
			let feedbackProgress = 'Not Started';
			const targetedFeedback = document.getElementById('targeted-feedback').value.trim();
			const areasImprovement = document.getElementById('areas-improvement').value.trim();
			if (targetedFeedback && areasImprovement) {
				feedbackProgress = 'Completed';
				completedSections++;
			} else if (targetedFeedback || areasImprovement) {
				feedbackProgress = 'In Progress';
			}
			document.getElementById('progress-feedback').textContent = feedbackProgress;
			document.getElementById('icon-feedback').className = `progress-icon ${feedbackProgress.toLowerCase().replace(' ', '-')}`;

			// Signatures Progress
			let signaturesProgress = 'Not Started';
			const coach1Name = document.getElementById('coach1-name').value.trim();
			const coach2Name = document.getElementById('coach2-name').value.trim();
			const technicalDirector = document.getElementById('technical-director').value.trim();
			const defaultCoach1 = 'Melvin Chow';
			const defaultCoach2 = 'Lee Hong Lim';
			const defaultTechnicalDirector = 'Darren Bowman';
			if (
				(coach1Name && coach1Name !== defaultCoach1) ||
				(coach2Name && coach2Name !== defaultCoach2) ||
				(technicalDirector && technicalDirector !== defaultTechnicalDirector)
			) {
				signaturesProgress = 'Completed';
				completedSections++;
			} else if (coach1Name || coach2Name || technicalDirector) {
				signaturesProgress = 'In Progress';
			}
			document.getElementById('progress-signatures').textContent = signaturesProgress;
			document.getElementById('icon-signatures').className = `progress-icon ${signaturesProgress.toLowerCase().replace(' ', '-')}`;

			// Update overall progress
			const progressPercentage = Math.round((completedSections / totalSections) * 100);
			const progressBarFill = document.getElementById('progress-bar-fill');
			progressBarFill.style.width = `${progressPercentage}%`;
			document.getElementById('progress-percentage').textContent = `${progressPercentage}%`;
		}

		function updateProgressItem(section, isComplete) {
			const icon = document.getElementById(`icon-${section}`);
			const progressText = document.getElementById(`progress-${section}`);
			
			if (isComplete) {
				icon.textContent = '✅';
				icon.className = 'progress-icon mr-2 completed';
				progressText.textContent = 'Completed';
			} else {
				const hasData = checkSectionHasData(section);
				icon.textContent = hasData ? '🍊' : '⏳';
				icon.className = `progress-icon mr-2 ${hasData ? 'in-progress' : 'not-started'}`;
				progressText.textContent = hasData ? 'In Progress' : 'Not Started';
			}
		}
		
		function checkSectionHasData(section) {
		const monthKeys = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];
		switch (section) {
			case 'player':
				if (manualPlayerDataRadio.checked) {
					return manualFirstName.value || manualLastName.value || portraitImageData;
				} else {
					return !!selectedPlayerData || portraitImageData;
				}
			case 'height':
				const startMonthHeight = parseInt(document.getElementById('height-start-month').value);
				const endMonthHeight = parseInt(document.getElementById('height-end-month').value);
				const relevantMonthsHeight = [];
				for (let i = Math.min(startMonthHeight, endMonthHeight); i <= Math.max(startMonthHeight, endMonthHeight); i++) {
					relevantMonthsHeight.push(monthKeys[i]);
				}
				const heightInputsCheck = relevantMonthsHeight.map(month => document.getElementById(`height-${month}`)).filter(input => input);
				return heightInputsCheck.some(input => input.value && parseFloat(input.value) > 0);
			case 'attendance':
				const attendanceInputs = document.querySelectorAll('#attendance-manual-input input[type="number"]');
				return Array.from(attendanceInputs).some(input => input.value !== '' && parseInt(input.value) > 0);
			case 'ratings':
				return false; // Sliders always have a default value, so no "in progress" state
			case 'grades':
				return false; // Dropdowns always have a default value
			case 'feedback':
				const targetedFeedback = document.getElementById('targeted-feedback').value;
				const areasImprovement = document.getElementById('areas-improvement').value;
				return targetedFeedback || areasImprovement;
			case 'signatures':
				const coach1Name = document.getElementById('coach1-name').value;
				const coach2Name = document.getElementById('coach2-name').value;
				const technicalDirector = document.getElementById('technical-director').value;
				return coach1Name || coach2Name || technicalDirector;
			default:
				return false;
		}
	}
		

		function resetForm() {
			// Reset player data inputs
			document.getElementById('manual-first-name').value = '';
			document.getElementById('manual-last-name').value = '';
			document.getElementById('manual-dob').value = '';
			document.getElementById('manual-position').value = '';
			document.getElementById('portraitFile').value = '';
			portraitImageData = null;
			document.getElementById('clubLogoFile').value = '';
			clubLogoImageData = null;
			document.getElementById('xlsFile').value = '';
			playerSelect.innerHTML = '<option value="">Select a player...</option>';
			playerSelectContainer.classList.add('hidden');
			playersData = [];
			selectedPlayerData = null;

			// Reset height inputs
			document.getElementById('height-start-month').value = '0';
			document.getElementById('height-end-month').value = '5';
			document.getElementById('height-year').value = new Date().getFullYear();
			populateHeightInputs();

			// Reset attendance inputs
			document.getElementById('total-training-sessions').value = '0';
			document.getElementById('training-sessions-attended').value = '0';
			document.getElementById('total-training-minutes').value = '0';
			document.getElementById('total-matches').value = '0';
			document.getElementById('matches-played').value = '0';
			document.getElementById('total-match-minutes').value = '0';
			document.getElementById('match-minutes-played').value = '0';

			// Reset sliders
			sliders.forEach(id => {
				const slider = document.getElementById(id);
				slider.value = '3';
				document.getElementById(`${id}-value`).textContent = '3';
			});

			// Reset ratings flags
			ratingsLoadedFromFile = false;
			ratingsManuallyChanged.clear();

			// Reset grades
			document.getElementById('current-grade').value = 'A';
			document.getElementById('target-grade').value = 'A';

			// Reset feedback
			document.getElementById('targeted-feedback').value = '';
			document.getElementById('areas-improvement').value = '';

			// Reset signatures
			document.getElementById('coach1-name').value = 'Melvin Chow';
			document.getElementById('coach1-title').value = 'Coach';
			document.getElementById('coach2-name').value = 'Lee Hong Lim';
			document.getElementById('coach2-title').value = 'Coach';
			document.getElementById('technical-director').value = 'Darren Bowman';
			document.getElementById('technical-director-title').value = 'Technical Director';

			// Reset preview
			reportPreview.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-300 py-12">Your report preview will appear here.</div>';
			pdfControls.classList.add('hidden');

			updateGenerateButtonState();
			updateProgress();
			showStatus('Form has been reset.', 'info');
		}


		function formatMonthForDisplay(month, year) {
			const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
			const twoDigitYear = year.toString().slice(-2); // Get last two digits of the year
			return `${months[month]} ${twoDigitYear}`; // e.g., "Dec 24"
		}

		function generateReport() {
			try {
				showStatus('Generating report...', 'info');
				if (!portraitImageData) {
					showStatus('Please upload a player portrait before generating the report.', 'error');
					return;
				}

				let playerInfo;
				if (manualPlayerDataRadio.checked) {
					const firstName = manualFirstName.value.trim();
					const lastName = manualLastName.value.trim();
					if (!firstName && !lastName) {
						showStatus('Please enter a first name or last name for manual input.', 'error');
						return;
					}
					playerInfo = {
						firstName: firstName || 'Unknown',
						lastName: lastName || 'Player',
						sdob: manualDob.value ? new Date(manualDob.value).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }) : 'N/A',
						position: manualPosition.value || ''
					};
				} else if (selectedPlayerData) {
					playerInfo = {
						firstName: selectedPlayerData['First Name'] || 'Unknown',
						lastName: selectedPlayerData['Last Name'] || 'Player',
						sdob: formatExcelDate(selectedPlayerData['Date of Birth']),
						position: selectedPlayerData['Position'] || ''
					};
				} else {
					showStatus('No player data available to generate report.', 'error');
					return;
				}

				const startMonth = parseInt(document.getElementById('height-start-month').value);
				const endMonth = parseInt(document.getElementById('height-end-month').value);
				const baseYear = parseInt(document.getElementById('height-year').value);
				const months = [
					'january', 'february', 'march', 'april', 'may', 'june',
					'july', 'august', 'september', 'october', 'november', 'december'
				];
				const monthShortNames = [
					'JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN',
					'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'
				];
				const heightData = [];
				 let totalGrowth = 0;
					let heightSectionHTML = '';
					if (currentHeightGrowthData.length > 0) {
						heightSectionHTML = `
							<div class="mb-8">
								<h3 class="font-bold text-xl mb-4 text-primary">Height Growth Over Season</h3>
								<div class="border rounded-lg p-2 overflow-x-auto">
									<table class="w-full text-left">
										<thead>
											<tr class="border-b">
												<th class="p-2">Month</th>
												${currentHeightGrowthData.map(data => `<th class="p-2">${formatMonthForDisplay(data.month, data.year)}</th>`).join('')}
											</tr>
										</thead>
										<tbody>
											<tr class="border-b">
												<td class="p-2">Height (cm)</td>
												${currentHeightGrowthData.map(data => `<td class="p-2">${data.height || '-'}</td>`).join('')}
											</tr>
											${currentTotalGrowth !== 0 ? `
											<tr>
												<td class="p-2 font-semibold">Total Growth</td>
												<td class="p-2 text-primary font-semibold" colspan="${currentHeightGrowthData.length}">${currentTotalGrowth > 0 ? '+' : ''}${currentTotalGrowth} cm</td>
											</tr>` : ''}
										</tbody>
									</table>
								</div>
							</div>
						`;

					} else {
						heightSectionHTML = `
							<div class="mb-8">
								<h3 class="font-bold text-xl mb-4 text-primary">Height Growth Over Season (${heightYear})</h3>
								<div class="border rounded-lg p-2 text-center text-gray-500">No height data available.</div>
							</div>`;
					}

				const attendanceData = {
					training: {
						totalSessions: parseInt(document.getElementById('total-training-sessions')?.value || 0),
						sessionsAttended: parseInt(document.getElementById('training-sessions-attended')?.value || 0),
						totalMinutes: parseInt(document.getElementById('total-training-minutes')?.value || 0)
					},
					match: {
						totalMatches: parseInt(document.getElementById('total-matches')?.value || 0),
						matchesPlayed: parseInt(document.getElementById('matches-played')?.value || 0),
						totalMinutes: parseInt(document.getElementById('total-match-minutes')?.value || 0),
						minutesPlayed: parseInt(document.getElementById('match-minutes-played')?.value || 0)
					}
				};

				const trainingAttendancePercentage = attendanceData.training.totalSessions > 0 
					? (attendanceData.training.sessionsAttended / attendanceData.training.totalSessions * 100).toFixed(1) 
					: 0;
				const matchMinutesPercentage = attendanceData.match.totalMinutes > 0 
					? (attendanceData.match.minutesPlayed / attendanceData.match.totalMinutes * 100).toFixed(1) 
					: 0;

				const ratings = {};
				sliders.forEach(id => {
					const slider = document.getElementById(id);
					ratings[id] = slider ? parseInt(slider.value) : 3;
				});

				const gameIntelligenceAvg = ((ratings['movement-to-receive'] + ratings['actions-to-create'] + ratings['actions-to-disrupt']) / 3).toFixed(1);
				const technicalAbilityAvg = ((ratings['with-balance'] + ratings['with-speed'] + ratings['execution']) / 3).toFixed(1);
				const physicalCapacityAvg = ((ratings['speed'] + ratings['aggressive'] + ratings['dominant']) / 3).toFixed(1);
				const socialCompetenceAvg = ((ratings['communication'] + ratings['demanding'] + ratings['confidence']) / 3).toFixed(1);

				const coach1Name = document.getElementById('coach1-name')?.value || 'Melvin Chow';
				const coach1Title = document.getElementById('coach1-title')?.value || 'Coach';
				const coach2Name = document.getElementById('coach2-name')?.value || 'Lee Hong Lim';
				const coach2Title = document.getElementById('coach2-title')?.value || 'Coach';
				const technicalDirector = document.getElementById('technical-director')?.value || 'Darren Bowman';
				const technicalDirectorTitle = document.getElementById('technical-director-title')?.value || 'Technical Director';
				const targetedFeedback = document.getElementById('targeted-feedback')?.value || '';
				const areasImprovement = document.getElementById('areas-improvement')?.value || '';
				const currentGrade = document.getElementById('current-grade')?.value || 'A';
				const targetGrade = document.getElementById('target-grade')?.value || 'A';

				const gradeStyles = {
					'A': 'bg-green-200 text-green-800 font-semibold',
					'B': 'bg-lime-200 text-lime-800 font-semibold',
					'C': 'bg-yellow-200 text-yellow-800 font-semibold',
					'D': 'bg-orange-200 text-orange-800 font-semibold',
					'E': 'bg-red-200 text-red-800 font-semibold'
				};
				const currentGradeStyle = gradeStyles[currentGrade] || 'bg-gray-200 text-gray-800';
				const targetGradeStyle = gradeStyles[targetGrade] || 'bg-gray-200 text-gray-800';

				let clubLogoHTML = clubLogoData 
					? `<img src="${clubLogoData}" alt="Club Logo" class="w-full h-auto">` 
					: `<img src="${defaultClubLogoSVG}" alt="Club Logo" class="w-full h-auto">`;
				let portraitHTML = portraitImageData 
					? `<img src="${portraitImageData}" alt="Player Portrait" class="w-full h-full object-cover border-2 border-gray-300">` 
					: '<div class="w-full h-full bg-gray-200 flex items-center justify-center border-2 border-gray-300"><span class="text-gray-500">No Photo</span></div>';
				let positionHTML = playerInfo.position ? `<p class="text-gray-600 dark:text-gray-300">Position: ${playerInfo.position}</p>` : '';

				const reportHTML = `
					<div class="bg-white text-black p-8 print:p-[0.5cm] w-full max-w-[19cm] mx-auto" id="report-container" style="height: auto; overflow: visible; page-break-inside: auto; break-inside: auto;">
						<div class="mb-6 border-b-2 border-primary pb-4">
							<div class="grid grid-cols-6 gap-4 mb-4">
								<div class="col-span-1">${clubLogoHTML}</div>
								<div class="col-span-5">
									<h1 class="text-3xl font-bold text-primary">Player Performance Review</h1>
								</div>
							</div>
							<div class="grid grid-cols-4 gap-4">
								<div class="col-span-3">
									<h2 class="text-xl font-semibold">${playerInfo.firstName} ${playerInfo.lastName}</h2>
									<p class="text-gray-600 dark:text-gray-300">Date of Birth: ${playerInfo.sdob}</p>
									${positionHTML}
									<p class="text-gray-600 dark:text-gray-300">Review Date: ${new Date().toLocaleDateString()}</p>
								</div>
								<div class="col-span-1">
									<div class="w-32 h-32 overflow-hidden">${portraitHTML}</div>
								</div>
							</div>
						</div>
						
						${heightSectionHTML}
						
						<div class="mb-8">
							<h3 class="font-bold text-xl mb-4 text-primary">Player Attendance</h3>
							<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
								<div class="border rounded-lg p-2">
									<h4 class="font-bold text-lg mb-3">Training Attendance</h4>
									<div class="space-y-2">
										<div class="flex justify-between"><span>Total Training Sessions:</span><span class="font-medium">${attendanceData.training.totalSessions}</span></div>
										<div class="flex justify-between"><span>Sessions Attended:</span><span class="font-medium">${attendanceData.training.sessionsAttended}</span></div>
										<div class="flex justify-between"><span>Total Training Minutes:</span><span class="font-medium">${attendanceData.training.totalMinutes}</span></div>
										<div class="flex justify-between text-primary font-semibold mt-2 pt-2 border-t"><span>Attendance Rate:</span><span>${trainingAttendancePercentage}%</span></div>
										<div class="w-full bg-gray-200 rounded-full h-2.5 mt-1"><div class="bg-gradient-to-r from-primary to-secondary h-2.5 rounded-full progress-fill" style="--progress-width: ${trainingAttendancePercentage}%; width: ${trainingAttendancePercentage}%"></div></div>
									</div>
								</div>
								<div class="border rounded-lg p-2">
									<h4 class="font-bold text-lg mb-3">Match Clock</h4>
									<div class="space-y-2">
										<div class="flex justify-between"><span>Total Matches:</span><span class="font-medium">${attendanceData.match.totalMatches}</span></div>
										<div class="flex justify-between"><span>Played:</span><span class="font-medium">${attendanceData.match.matchesPlayed}</span></div>
										<div class="flex justify-between"><span>Total Minutes:</span><span class="font-medium">${attendanceData.match.totalMinutes}</span></div>
										<div class="flex justify-between"><span>Minutes Played:</span><span class="font-medium">${attendanceData.match.minutesPlayed}</span></div>
										<div class="flex justify-between text-primary font-semibold mt-2 pt-2 border-t"><span> </span><span>${matchMinutesPercentage}%</span></div>
										<div class="w-full bg-gray-200 rounded-full h-2.5 mt-1"><div class="bg-gradient-to-r from-primary to-secondary h-2.5 rounded-full progress-fill" style="--progress-width: ${matchMinutesPercentage}%; width: ${matchMinutesPercentage}%"></div></div>
									</div>
								</div>
							</div>
						</div>
							<h3 class="font-bold text-xl mb-4 text-primary">Player Evaluation</h3>
						<div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-6">
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-lg mb-2 text-primary">Player Evaluation Radar</h3>
								<div class="flex justify-center"><div class="shadow-md flex justify-center items-center" style="width: 200px; height: 200px;"><canvas id="skills-radar"></canvas></div></div>
							</div>
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-lg mb-2 text-primary">Player Grades</h3>
								<div class="grid grid-cols-1 gap-4">
									<div>
										<p class="font-medium text-base">Current Grade</p>
										<p class="${currentGradeStyle} text-center text-lg p-2 rounded-md">${currentGrade}</p>
									</div>
									<div>
										<p class="font-medium text-base">Target Grade</p>
										<p class="${targetGradeStyle} text-center text-lg p-2 rounded-md">${targetGrade}</p>
									</div>
								</div>
							</div>
						</div>
						<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-base mb-1 text-primary">Game Intelligence</h3>
								<div class="space-y-1 text-base">
									${createRatingBar('Movement to Receive', ratings['movement-to-receive'])}
									${createRatingBar('Actions to Create', ratings['actions-to-create'])}
									${createRatingBar('Actions to Disrupt', ratings['actions-to-disrupt'])}
								</div>
							</div>
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-base mb-1 text-primary">Technical Ability</h3>
								<div class="space-y-1 text-base">
									${createRatingBar('With Balance', ratings['with-balance'])}
									${createRatingBar('With Speed', ratings['with-speed'])}
									${createRatingBar('Execution', ratings['execution'])}
								</div>
							</div>
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-base mb-1 text-primary">Physical Capacity</h3>
								<div class="space-y-1 text-base">
									${createRatingBar('Speed', ratings['speed'])}
									${createRatingBar('Aggressive', ratings['aggressive'])}
									${createRatingBar('Dominant', ratings['dominant'])}
								</div>
							</div>
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-base mb-1 text-primary">Social Competence</h3>
								<div class="space-y-1 text-base">
									${createRatingBar('Communication', ratings['communication'])}
									${createRatingBar('Demanding', ratings['demanding'])}
									${createRatingBar('Confidence', ratings['confidence'])}
								</div>
							</div>
						</div>
						<div class="space-y-2 mb-4">
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-base mb-1 text-primary">Targeted Feedback</h3>
								<p class="whitespace-pre-line text-base">${targetedFeedback || 'No feedback provided.'}</p>
							</div>
							<div class="border rounded-lg p-2">
								<h3 class="font-bold text-base mb-1 text-primary">Areas of Improvement</h3>
								<p class="whitespace-pre-line text-base">${areasImprovement || 'No areas of improvement identified.'}</p>
							</div>
						</div>
						<div class="mt-6 mb-4 signature-section">
							<div class="flex flex-wrap justify-between">
								<div class="text-center mx-2 mb-2"><div class="signature-line"></div><p class="mt-1 text-base">${coach1Name}</p><p class="text-sm text-gray-600 dark:text-gray-300">${coach1Title}</p></div>
								<div class="text-center mx-2 mb-2"><div class="signature-line"></div><p class="mt-1 text-base">${coach2Name}</p><p class="text-sm text-gray-600 dark:text-gray-300">${coach2Title}</p></div>
								<div class="text-center mx-2 mb-2"><div class="signature-line"></div><p class="mt-1 text-base">${technicalDirector}</p><p class="text-sm text-gray-600 dark:text-gray-300">${technicalDirectorTitle}</p></div>
							</div>
						</div>
						<div class="text-center text-sm text-gray-500 border-t-2 border-gray-200 pt-2 mt-4">
							<p>Lee Man Football Club - Player Development Report</p>
							<p>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
						</div>
					</div>
				`;

				currentReportHTML = reportHTML;
				currentAttendanceData = attendanceData;
				reportPreview.innerHTML = reportHTML;
				pdfControls.classList.remove('hidden');

				const playerName = `${playerInfo.firstName} ${playerInfo.lastName}`;
				const reportData = getCurrentSessionData();
				const reportEntry = {
					name: playerName,
					html: reportHTML,
					data: reportData,
					timestamp: new Date().toISOString()
				};
				savedReports.push(reportEntry);
				updateSavedReportsList();

				const canvas = document.getElementById('skills-radar');
				if (canvas && canvas.getContext) {
					const ctx = canvas.getContext('2d');
					if (window.skillsChart) window.skillsChart.destroy();

					window.skillsChart = new Chart(ctx, {
						type: 'radar',
						data: {
							labels: ['GI.', 'TA', 'PC', 'SC'],
							datasets: [{
								label: 'Player Skills',
								data: [gameIntelligenceAvg, technicalAbilityAvg, physicalCapacityAvg, socialCompetenceAvg],
								backgroundColor: (context) => {
									const chart = context.chart;
									const { ctx, chartArea } = chart;
									if (!chartArea) return 'rgba(255, 215, 0, 0.2)';
									const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
									gradient.addColorStop(0, 'rgba(255, 215, 0, 0.1)');
									gradient.addColorStop(1, 'rgba(230, 194, 0, 0.3)');
									return gradient;
								},
								borderColor: '#FFD700',
								pointBackgroundColor: '#FFD700',
								pointBorderColor: '#fff',
								pointHoverBackgroundColor: '#fff',
								pointHoverBorderColor: '#FFD700'
							}]
						},
						options: {
							animation: {
								onComplete: () => {
									const chartImage = canvas.toDataURL('image/png');
									currentReportHTML = currentReportHTML.replace(
										'<canvas id="skills-radar"></canvas>',
										`<img src="${chartImage}" alt="Player Evaluation Radar" style="width: 200px; height: 200px;">`
									);
									reportPreview.innerHTML = currentReportHTML;
									reportEntry.html = currentReportHTML;
								}
							},
							layout: {
								padding: {
									left: 5,
									right: 5,
									top: 5,
									bottom: 5
								}
							},
							plugins: {
								legend: { display: false }
							},
							scales: {
								r: {
									angleLines: { display: true },
									min: 0,
									max: 5,
									ticks: { stepSize: 1 },
									grid: { circular: true },
									pointLabels: {
										font: {
											size: 10,
											family: 'Poppins'
										},
										padding: 10
									}
								}
							}
						}
					});
				} else {
					console.error('Canvas element not found or context unavailable');
					showStatus('Skills chart could not be rendered, but report was saved.', 'warning');
				}

				showStatus('Report generated and saved successfully!', 'success');
			} catch (error) {
				console.error('Error in generateReport:', error);
				showStatus('Error generating report: ' + error.message, 'error');
			}
		}

		function createRatingBar(label, value) {
			const stars = Array(5).fill(0).map((_, i) => 
				i < value ? '<span class="text-primary">★</span>' : '<span class="text-gray-300">★</span>'
			).join('');
			return `
				<div>
					<div class="flex justify-between mb-1"><span class="text-sm">${label}</span><span class="text-sm">${value}/5</span></div>
					<div class="flex">${stars}</div>
				</div>
			`;
		}

		function showStatus(message, type) {
			statusMessage.textContent = message;
			statusMessage.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');
			switch (type) {
				case 'success': statusMessage.classList.add('bg-green-100', 'text-green-800'); break;
				case 'error': statusMessage.classList.add('bg-red-100', 'text-red-800'); break;
				case 'info': default: statusMessage.classList.add('bg-blue-100', 'text-blue-800'); break;
			}
			if (type !== 'error') setTimeout(() => statusMessage.classList.add('hidden'), 5000);
		}

		function preparePrintView() {
			try {
				const printWindow = window.open('', '_blank', 'width=800,height=600');
				if (!printWindow) {
					showStatus('Failed to open print window. Please allow pop-ups.', 'error');
					return;
				}

				// Extract data from the current report
				const tempDiv = document.createElement('div');
				tempDiv.innerHTML = currentReportHTML;

				const attendanceData = currentAttendanceData;
				const trainingAttendancePercentage = attendanceData.training.totalSessions > 0 
					? (attendanceData.training.sessionsAttended / attendanceData.training.totalSessions * 100).toFixed(1) 
					: 0;
				const matchMinutesPercentage = attendanceData.match.totalMinutes > 0 
					? (attendanceData.match.minutesPlayed / attendanceData.match.totalMinutes * 100).toFixed(1) 
					: 0;

				// Extract logo and player info
				const logoSection = tempDiv.querySelector('.grid.grid-cols-6');
				const logoImg = logoSection ? logoSection.querySelector('img') : null;
				const logoHtml = logoImg ? `<img src="${logoImg.src}" alt="Club Logo" style="max-width: 100px; height: auto;">` : '';

				const playerInfoDiv = tempDiv.querySelector('.grid.grid-cols-4');
				const playerName = playerInfoDiv ? playerInfoDiv.querySelector('h2').textContent : 'Player Report';
				const dobMatch = playerInfoDiv ? playerInfoDiv.innerHTML.match(/Date of Birth: ([\d\/]+)/) : null;
				const dob = dobMatch ? dobMatch[1] : 'N/A';
				const positionMatch = playerInfoDiv ? playerInfoDiv.innerHTML.match(/Position: ([^<]+)/) : null;
				const position = positionMatch ? positionMatch[1] : '';
				const reviewDateMatch = playerInfoDiv ? playerInfoDiv.innerHTML.match(/Review Date: ([\d\/]+)/) : null;
				const reviewDate = reviewDateMatch ? reviewDateMatch[1] : new Date().toLocaleDateString();
				const portraitImg = playerInfoDiv ? playerInfoDiv.querySelector('img') : null;
				const portraitHtml = portraitImg ? `<img src="${portraitImg.src}" alt="Player Portrait" style="width: 100px; height: 100px; object-fit: cover; border: 2px solid #ddd;">` : '<div style="width: 100px; height: 100px; background: #e0e0e0; display: flex; align-items: center; justify-content: center; border: 2px solid #ddd;">No Photo</div>';

				// Extract chart
				const chartEl = tempDiv.querySelector('img[alt="Player Evaluation Radar"]');
				const chartHtml = chartEl ? `<img src="${chartEl.src}" alt="Player Evaluation Radar" style="width: 200px; height: 200px;">` : '<div style="text-align: center; color: #666;">Chart not available in print preview</div>';

				// Extract height growth data
				const heightYear = document.getElementById('height-year').value;
				const heightGrowthData = currentHeightGrowthData;
				const totalGrowthPrint = currentTotalGrowth !== 0 ? `${currentTotalGrowth > 0 ? '+' : ''}${currentTotalGrowth} cm` : '';

				// Extract grades
				const gradeEls = tempDiv.querySelectorAll('.bg-green-200, .bg-lime-200, .bg-yellow-200, .bg-orange-200, .bg-red-200');
				const currentGrade = gradeEls[0] ? gradeEls[0].textContent.trim() : 'A';
				const targetGrade = gradeEls[1] ? gradeEls[1].textContent.trim() : 'A';

				// Helper function to extract ratings
				function extractRatings(container) {
					const result = [];
					const ratingRows = container.querySelectorAll('.flex.justify-between');
					ratingRows.forEach(row => {
						const skill = row.querySelector('span:first-child').textContent;
						const rating = row.querySelector('span:last-child').textContent;
						const numRating = parseInt(rating.split('/')[0]);
						let stars = '';
						for (let i = 1; i <= 5; i++) {
							if (i <= numRating) {
								stars += '<span class="gold-star">★</span>';
							} else {
								stars += '<span class="gray-star">★</span>';
							}
						}
						result.push({ skill, rating, stars });
					});
					return result;
				}

				// Extract ratings for each category
				function findSectionByTitle(title, headerTag = 'h3') {
					const sectionHeaders = tempDiv.querySelectorAll(`.border ${headerTag}`);
					for (let header of sectionHeaders) {
						if (header.textContent.trim() === title) {
							return header.parentElement;
						}
					}
					return null;
				}

				const gameIntelligence = findSectionByTitle('Game Intelligence');
				const gameRatings = gameIntelligence ? extractRatings(gameIntelligence) : [];
				const techAbility = findSectionByTitle('Technical Ability');
				const techRatings = techAbility ? extractRatings(techAbility) : [];
				const physCapacity = findSectionByTitle('Physical Capacity');
				const physRatings = physCapacity ? extractRatings(physCapacity) : [];
				const socialComp = findSectionByTitle('Social Competence');
				const socialRatings = socialComp ? extractRatings(socialComp) : [];

				// Extract feedback
				const feedbackEls = tempDiv.querySelectorAll('.space-y-2 .border');
				const targetedFeedback = feedbackEls[0] ? feedbackEls[0].querySelector('p').textContent : 'No feedback provided.';
				const areasImprovement = feedbackEls[1] ? feedbackEls[1].querySelector('p').textContent : 'No areas of improvement identified.';

				// Extract signatures
				const sigEls = tempDiv.querySelectorAll('.signature-section .text-center');
				const signatures = [];
				sigEls.forEach(sig => {
					const name = sig.querySelector('p:first-of-type').textContent;
					const title = sig.querySelector('p:last-of-type').textContent;
					signatures.push({ name, title });
				});

				// Build the full HTML with updated styles
				const fullHtml = `
					<!DOCTYPE html>
					<html lang="en">
					<head>
						<meta charset="UTF-8">
						<title>Player Report - ${playerName}</title>
						<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
						<style>
							body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background: white; }
							.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
							.logo { width: 100px; }
							.title { font-size: 28px; font-weight: 700; color: #FFD700; }
							.player-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
							.player-name { font-size: 24px; font-weight: 600; }
							.player-meta { font-size: 14px; color: #666; }
							.player-photo { width: 100px; height: 100px; margin-left: 20px; }
							.section { margin-bottom: 25px; }
							.section-title { font-size: 24px; font-weight: 600; color: #FFD700; margin-bottom: 8px; }
							.box { border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
							.box-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; }
							.row { display: flex; gap: 20px; margin-bottom: 20px; }
							.col { flex: 1; }
							.rating-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
							.stars { font-size: 22px; }
							.gold-star { color: #FFD700; }
							.gray-star { color: #ccc; }
							.grade { font-size: 24px; font-weight: bold; text-align: center; padding: 10px; border-radius: 5px; }
							.grade-a { background-color: #d4edda; color: #155724; }
							.grade-b { background-color: #e6ffb3; color: #5c7c00; }
							.grade-c { background-color: #fff3cd; color: #856404; }
							.grade-d { background-color: #ffeeba; color: #d9534f; }
							.grade-e { background-color: #f8d7da; color: #721c24; }
							.signatures { display: flex; justify-content: space-around; margin-top: 40px; }
							.signature { text-align: center; }
							.signature-line { width: 150px; height: 1px; background: black; margin: 0 auto 8px; }
							.signature-name { font-weight: bold; }
							.signature-title { font-size: 12px; color: #666; }
							.footer { text-align: center; font-size: 12px; color: #666; margin-top: 20px; border-top: 1px solid #ddd; padding-top: 10px; }
							.chart-container { display: flex; justify-content: center; }
							.chart-info { text-align: center; color: #666; }
							.progress-bar { width: 100%; background: #e0e0e0; height: 10px; border-radius: 5px; overflow: hidden; }
							.progress-fill { height: 100%; transition: width 0.3s ease; }
							.progress-green { background: #10b981; }
							.progress-amber { background: #f59e0b; }
							.progress-red { background: #ef4444; }
							.data-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
							.data-row.highlight { font-weight: bold; color: #FFD700; }
							/* Added style for the height growth table */
							.height-table { font-size: 12px; } /* Adjust font size here */
							.print-buttons {
								display: flex;
								gap: 10px;
								position: fixed;
								bottom: 20px;
								right: 20px;
							}
							.print-buttons button {
								padding: 10px 20px;
								background-color: #FFD700;
								color: white;
								border: none;
								border-radius: 5px;
								cursor: pointer;
								transition: background-color 0.2s ease;
								font-family: 'Poppins', sans-serif;
								font-weight: 500;
								font-size: 14px;
							}
							.print-buttons button:hover {
								background-color: #E6C200;
							}
							@media (max-width: 640px) {
								.print-buttons {
									flex-direction: column;
									bottom: 10px;
									right: 10px;
								}
								.print-buttons button {
									width: 100%;
									text-align: center;
								}
							}
							@media print {
								@page { size: A4 portrait; margin: 1cm; }
								.no-print { display: none; }
								.section { page-break-inside: avoid; break-inside: avoid; }
								.page-break-before { page-break-before: always; break-before: page; }
							}
						</style>
					</head>
					<body>
						<div id="report-container" style="padding: 0.5cm; max-width: 19cm; margin: 0 auto;">
							<div class="header">
								<div class="logo">${logoHtml}</div>
								<div class="title">Player Performance Review</div>
							</div>
							<div class="player-info">
								<div class="player-details">
									<div class="player-name">${playerName}</div>
									<div class="player-meta">Date of Birth: ${dob}</div>
									${position ? `<div class="player-meta">Position: ${position}</div>` : ''}
									<div class="player-meta">Review Date: ${reviewDate}</div>
								</div>
								<div class="player-photo">${portraitHtml}</div>
							</div>
							
							<div class="section">
								<div class="section-title">Height Growth Over Season</div>
								<div class="box">
									<table class="height-table" style="width: 100%; border-collapse: collapse;">
										<thead>
											<tr style="border-bottom: 1px solid #ddd;">
												<th style="padding: 8px; text-align: left;">Month</th>
												${heightGrowthData.map(data => `<th style="padding: 8px; text-align: left;">${formatMonthForDisplay(data.month, data.year)}</th>`).join('')}
											</tr>
										</thead>
										<tbody>
											<tr style="border-bottom: 1px solid #ddd;">
												<td style="padding: 8px;">Height (cm)</td>
												${heightGrowthData.length > 0 ? heightGrowthData.map(data => `<td style="padding: 8px;">${data.height}</td>`).join('') : `<td colspan="1" style="padding: 8px; text-align: center; color: #666;">No height data available.</td>`}
											</tr>
											${totalGrowthPrint ? `<tr style="font-weight: bold; color: #FFD700;"><td style="padding: 8px;">Total Growth:</td><td colspan="${heightGrowthData.length}" style="padding: 8px;">${totalGrowthPrint}</td></tr>` : ''}
										</tbody>
									</table>
								</div>
							</div>
							
							<div class="section">
								<div class="section-title">Player Attendance</div>
								<div class="row">
									<div class="col">
										<div class="box">
											<div class="box-title">Training Attendance</div>
											<div class="data-row"><span>Total Sessions:</span><span>${attendanceData.training.totalSessions}</span></div>
											<div class="data-row"><span>Sessions Attended:</span><span>${attendanceData.training.sessionsAttended}</span></div>
											<div class="data-row"><span>Total Minutes:</span><span>${attendanceData.training.totalMinutes}</span></div>
											<div class="data-row highlight"><span>Attendance Rate:</span><span>${trainingAttendancePercentage}%</span></div>
											<div class="progress-bar"><div class="progress-fill ${trainingAttendancePercentage >= 80 ? 'progress-green' : trainingAttendancePercentage >= 60 ? 'progress-amber' : 'progress-red'}" style="width: ${trainingAttendancePercentage}%"></div></div>
										</div>
									</div>
									<div class="col">
										<div class="box">
											<div class="box-title">Match Clock</div>
											<div class="data-row"><span>Total Matches:</span><span>${attendanceData.match.totalMatches}</span></div>
											<div class="data-row"><span>Matches Played:</span><span>${attendanceData.match.matchesPlayed}</span></div>
											<div class="data-row"><span>Total Minutes:</span><span>${attendanceData.match.totalMinutes}</span></div>
											<div class="data-row"><span>Minutes Played:</span><span>${attendanceData.match.minutesPlayed}</span></div>
											<div class="data-row highlight"><span></span><span>${matchMinutesPercentage}%</span></div>
											<div class="progress-bar"><div class="progress-fill ${matchMinutesPercentage >= 80 ? 'progress-green' : matchMinutesPercentage >= 60 ? 'progress-amber' : 'progress-red'}" style="width: ${matchMinutesPercentage}%"></div></div>
										</div>
									</div>
								</div>
							</div>
							<div class="section">
								<div class="section-title">Player Evaluation</div>
								<div class="row">
									<div class="col">
										<div class="box">
											<div class="box-title">Player Evaluation Radar</div>
											<div class="chart-container">${chartHtml}</div>
										</div>
									</div>
									<div class="col">
										<div class="box">
											<div class="box-title">Player Grades</div>
											<div style="margin-bottom: 15px;">
												<div style="margin-bottom: 5px;">Current Grade</div>
												<div class="grade grade-${currentGrade.toLowerCase()}">${currentGrade}</div>
											</div>
											<div>
												<div style="margin-bottom: 5px;">Target Grade</div>
												<div class="grade grade-${targetGrade.toLowerCase()}">${targetGrade}</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- Ratings Section -->
							<div class="section page-break-before">
								<div class="row">
									<div class="col">
										<div class="box">
											<div class="box-title">Game Intelligence</div>
											${gameRatings.map(rating => `
												<div style="margin-bottom: 8px;">
													<div class="rating-row">
														<span>${rating.skill}</span>
														<span>${rating.rating}</span>
													</div>
													<div class="stars">${rating.stars}</div>
												</div>
											`).join('')}
										</div>
									</div>
									<div class="col">
										<div class="box">
											<div class="box-title">Technical Ability</div>
											${techRatings.map(rating => `
												<div style="margin-bottom: 8px;">
													<div class="rating-row">
														<span>${rating.skill}</span>
														<span>${rating.rating}</span>
													</div>
													<div class="stars">${rating.stars}</div>
												</div>
											`).join('')}
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col">
										<div class="box">
											<div class="box-title">Physical Capacity</div>
											${physRatings.map(rating => `
												<div style="margin-bottom: 8px;">
													<div class="rating-row">
														<span>${rating.skill}</span>
														<span>${rating.rating}</span>
													</div>
													<div class="stars">${rating.stars}</div>
												</div>
											`).join('')}
										</div>
									</div>
									<div class="col">
										<div class="box">
											<div class="box-title">Social Competence</div>
											${socialRatings.map(rating => `
												<div style="margin-bottom: 8px;">
													<div class="rating-row">
														<span>${rating.skill}</span>
														<span>${rating.rating}</span>
													</div>
													<div class="stars">${rating.stars}</div>
												</div>
											`).join('')}
										</div>
									</div>
								</div>
							</div>
							<!-- Feedback Section -->
							<div class="section">
								<div class="box">
									<div class="box-title">Targeted Feedback</div>
									<p style="white-space: pre-line;">${targetedFeedback}</p>
								</div>
								<div class="box">
									<div class="box-title">Areas of Improvement</div>
									<p style="white-space: pre-line;">${areasImprovement}</p>
								</div>
							</div>
							<!-- Signatures Section -->
							<div class="section">
								<div class="signatures">
									${signatures.map(sig => `
										<div class="signature">
											<p></P><p></p>
											<div class="signature-line"></div>
											<div class="signature-name">${sig.name}</div>
											<div class="signature-title">${sig.title}</div>
										</div>
									`).join('')}
								</div>
							</div>
							<div class="footer">
								<div>Lee Man Football Club - Player Development Report</div>
								<div>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</div>
							</div>
							<div class="print-buttons no-print">
								<button onclick="window.print()">Print</button>
								<button onclick="window.close()">Back to Editor</button>
							</div>
						</div>
					</body>
					</html>
				`;

				printWindow.document.open();
				printWindow.document.write(fullHtml);
				printWindow.document.close();

				printWindow.onload = () => {
					showStatus('Print window opened. Use browser print dialog to save as PDF.', 'success');
				};

			} catch (error) {
				console.error('Error preparing print view:', error);
				showStatus('Error: ' + error.message, 'error');
			}
		}
		
		
		

		function updateSavedReportsList() {
			const savedReportsList = document.getElementById('saved-reports-list');
			savedReportsList.innerHTML = '';

			if (savedReports.length === 0) {
				savedReportsList.innerHTML = '<li class="text-gray-500 dark:text-gray-300">No saved reports.</li>';
				return;
			}

			savedReports.forEach((report, index) => {
				const li = document.createElement('li');
				li.className = 'flex justify-between items-center p-2 border-b hover:bg-gray-100 dark:hover:bg-gray-700';
				li.innerHTML = `
					<span class="text-sm">${report.name} (${new Date(report.timestamp).toLocaleString()})</span>
					<div>
						<button onclick="viewSavedReport(${index})" class="text-blue-500 hover:text-blue-700 mr-2">View</button>
						<button onclick="deleteSavedReport(${index})" class="text-red-500 hover:text-red-700">Delete</button>
					</div>
				`;
				savedReportsList.appendChild(li);
			});
		}

		function viewSavedReport(index) {
			const report = savedReports[index];
			reportPreview.innerHTML = report.html;
			currentReportHTML = report.html;
			pdfControls.classList.remove('hidden');
			showStatus(`Viewing saved report for ${report.name}`, 'info');
		}

		function deleteSavedReport(index) {
			const reportName = savedReports[index].name;
			savedReports.splice(index, 1);
			updateSavedReportsList();
			showStatus(`Deleted saved report for ${reportName}`, 'success');
		}

		function getCurrentSessionData() {
			const data = selectedPlayerData ? { ...selectedPlayerData } : {};

			if (manualPlayerDataRadio.checked) {
				data['First Name'] = manualFirstName.value || '';
				data['Last Name'] = manualLastName.value || '';
				data['Date of Birth'] = manualDob.value || '';
				data['Position'] = manualPosition.value || '';
			}

			data['Total Training Sessions'] = parseInt(document.getElementById('total-training-sessions').value) || 0;
			data['Training Sessions Attended'] = parseInt(document.getElementById('training-sessions-attended').value) || 0;
			data['Total Training Minutes'] = parseInt(document.getElementById('total-training-minutes').value) || 0;
			data['Total Matches'] = parseInt(document.getElementById('total-matches').value) || 0;
			data['Matches Played'] = parseInt(document.getElementById('matches-played').value) || 0;
			data['Total Match Minutes'] = parseInt(document.getElementById('total-match-minutes').value) || 0;
			data['Match Minutes Played'] = parseInt(document.getElementById('match-minutes-played').value) || 0;

			sliders.forEach(id => {
				const slider = document.getElementById(id);
				const label = id.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
				data[label] = parseInt(slider.value) || 3;
			});

			data['Current Grade'] = document.getElementById('current-grade').value || 'A';
			data['Target Grade'] = document.getElementById('target-grade').value || 'A';
			data['Targeted Feedback'] = document.getElementById('targeted-feedback').value || '';
			data['Areas of Improvement'] = document.getElementById('areas-improvement').value || '';
			data['Coach 1 Name'] = document.getElementById('coach1-name').value || 'Melvin Chow';
			data['Coach 1 Title'] = document.getElementById('coach1-title').value || 'Coach';
			data['Coach 2 Name'] = document.getElementById('coach2-name').value || 'Lee Hong Lim';
			data['Coach 2 Title'] = document.getElementById('coach2-title').value || 'Coach';
			data['Technical Director'] = document.getElementById('technical-director').value || 'Darren Bowman';
			data['Technical Director Title'] = document.getElementById('technical-director-title').value || 'Technical Director';

			const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
			currentHeightGrowthData.forEach(entry => {
				const monthName = months[entry.month];
				data[`${monthName} Height ${entry.year}`] = entry.height || '';
			});
			data['Height Year'] = document.getElementById('height-year').value || new Date().getFullYear();

			return data;
		}

		function downloadAllSessionData() {
			try {
				if (savedReports.length === 0) {
					showStatus('No saved reports available to download.', 'error');
					return;
				}

				const headers = [
					'First Name', 'Last Name', 'Date of Birth', 'Position',
					'Total Training Sessions', 'Training Sessions Attended', 'Total Training Minutes',
					'Total Matches', 'Matches Played', 'Total Match Minutes', 'Match Minutes Played',
					'Movement to Receive', 'Actions to Create', 'Actions to Disrupt',
					'With Balance', 'With Speed', 'Execution',
					'Speed', 'Aggressive', 'Dominant',
					'Communication', 'Demanding', 'Confidence',
					'Current Grade', 'Target Grade',
					'Targeted Feedback', 'Areas of Improvement',
					'Coach 1 Name', 'Coach 1 Title', 'Coach 2 Name', 'Coach 2 Title',
					'Technical Director', 'Technical Director Title',
					'Height Year'
				];

				// Dynamically add height headers based on saved reports
				const allHeightKeys = new Set();
				savedReports.forEach(report => {
					Object.keys(report.data).forEach(key => {
						if (key.includes('Height') && key !== 'Height Year') {
							allHeightKeys.add(key);
						}
					});
				});
				const heightHeaders = Array.from(allHeightKeys).sort();
				const finalHeaders = [...headers, ...heightHeaders];

				const dataArray = [finalHeaders];
				savedReports.forEach(report => {
					const rowData = finalHeaders.map(header => {
						if (header === 'Date of Birth') {
							const dob = report.data[header];
							return typeof dob === 'number' && !isNaN(dob) ? formatExcelDate(dob) : dob || '';
						}
						return report.data[header] || '';
					});
					dataArray.push(rowData);
				});

				// ... rest of the function ...
			} catch (error) {
				console.error('Error downloading all session data:', error);
				showStatus('Error downloading session data: ' + error.message, 'error');
			}
		}

		function handleBeforeUnload(event) {
			if (savedReports.length > 0 && !hasDownloadedSessionData) {
				const message = 'You have unsaved session data. Please download it before closing the window to avoid losing your work.';
				event.preventDefault();
				event.returnValue = message;
				return message;
			}
		}

		function updateBeforeUnloadListener() {
			window.removeEventListener('beforeunload', handleBeforeUnload);
			if (savedReports.length > 0 && !hasDownloadedSessionData) {
				window.addEventListener('beforeunload', handleBeforeUnload);
			}
		}

		// DOMContentLoaded block with all event listeners
		document.addEventListener('DOMContentLoaded', () => {
			// Collapsible headers
			document.querySelectorAll('.collapsible-header').forEach(header => {
				header.addEventListener('click', () => toggleSection(header));
			});

			// Set "Form Progress" to be collapsed by default
			const progressHeader = document.querySelector('#progress-tracker .collapsible-header');
			const progressContent = document.querySelector('#progress-details');
			if (progressHeader && progressContent) {
				progressHeader.classList.remove('active');
				progressContent.classList.remove('active');
			}

			// Player input method toggle
			manualPlayerDataRadio.addEventListener('change', togglePlayerInput);
			filePlayerDataRadio.addEventListener('change', togglePlayerInput);

			// File uploads
			xlsFileInput.addEventListener('change', handleFileUpload);
			portraitFileInput.addEventListener('change', () => {
				const file = portraitFileInput.files[0];
				if (file) {
					const reader = new FileReader();
					reader.onload = (e) => {
						portraitImageData = e.target.result;
						showStatus('Player portrait uploaded successfully!', 'success');
						updateGenerateButtonState();
						updateProgress();
					};
					reader.readAsDataURL(file);
				}
			});
			clubLogoFileInput.addEventListener('change', handleClubLogoUpload);

			// Form controls
			manualFirstName.addEventListener('input', () => {
				updateGenerateButtonState();
				updateProgress();
			});
			manualLastName.addEventListener('input', () => {
				updateGenerateButtonState();
				updateProgress();
			});

			const monthNameToIndex = {
				'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
				'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11,
				'January': 0, 'February': 1, 'March': 2, 'April': 3, 'May': 4, 'June': 5,
				'July': 6, 'August': 7, 'September': 8, 'October': 9, 'November': 10, 'December': 11
			};

		playerSelect.addEventListener('change', () => {
			const index = playerSelect.value;
			selectedPlayerData = index ? playersData[index] : null;
			if (selectedPlayerData) {
				// Populate Player Data
				document.getElementById('manual-first-name').value = selectedPlayerData['First Name'] || '';
				document.getElementById('manual-last-name').value = selectedPlayerData['Last Name'] || '';
				document.getElementById('manual-dob').value = selectedPlayerData['Date of Birth'] || '';
				document.getElementById('manual-position').value = selectedPlayerData['Position'] || '';

				const monthNameToIndex = {
					'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
					'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11,
					'January': 0, 'February': 1, 'March': 2, 'April': 3, 'May': 4, 'June': 5,
					'July': 6, 'August': 7, 'September': 8, 'October': 9, 'November': 10, 'December': 11
				};
				const startMonthName = selectedPlayerData['Height Start Month'] || 'January';
				const endMonthName = selectedPlayerData['Height End Month'] || 'June';
				const startMonth = monthNameToIndex[startMonthName] !== undefined ? monthNameToIndex[startMonthName] : 0;
				const endMonth = monthNameToIndex[endMonthName] !== undefined ? monthNameToIndex[endMonthName] : 5;
				const baseYear = selectedPlayerData['Height Year'] || new Date().getFullYear();

				// Ensure the year dropdown is populated before setting its value
				populateYears();

				document.getElementById('height-start-month').value = startMonth;
				document.getElementById('height-end-month').value = endMonth;
				document.getElementById('height-year').value = baseYear;

				populateHeightInputs();

				// Populate height inputs with data
				const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
				const isCrossYear = startMonth > endMonth; // Cross-year if start month is greater than end month
				document.querySelectorAll('.height-input').forEach(input => {
					const month = parseInt(input.dataset.month);
					const year = parseInt(input.dataset.year);
					const monthName = months[month];
					let heightKey;
					let heightValue;

					if (isCrossYear) {
						if (year === parseInt(baseYear)) {
							// Months in the base year (e.g., Aug 2024 to Dec 2024)
							if (month >= startMonth) {
								heightKey = `${monthName} Height`;
								heightValue = selectedPlayerData[heightKey] || '';
							} else {
								heightValue = '';
							}
						} else {
							// Months in the next year (e.g., Jan 2025 to Mar 2025)
							if (month <= endMonth) {
								// Use the base column name (e.g., "Jan Height") for 2025 months
								heightKey = `${monthName} Height`;
								heightValue = selectedPlayerData[heightKey] || '';
							} else {
								heightValue = '';
							}
						}
					} else {
						// Non-cross-year scenario (e.g., Jan 2024 to Jun 2024)
						if (year === parseInt(baseYear) && month >= startMonth && month <= endMonth) {
							heightKey = `${monthName} Height`;
							heightValue = selectedPlayerData[heightKey] || '';
						} else {
							heightValue = '';
						}
					}

					console.log(`Month: ${monthName} ${year}, Height Key: ${heightKey || 'N/A'}, Value: ${heightValue}`); // Debugging
					input.value = heightValue;
					const entry = currentHeightGrowthData.find(e => e.month === month && e.year === year);
					if (entry) entry.height = heightValue;
				});

				// Populate Attendance Data
				document.getElementById('total-training-sessions').value = selectedPlayerData['Total Training Sessions'] || 0;
				document.getElementById('training-sessions-attended').value = selectedPlayerData['Training Sessions Attended'] || 0;
				document.getElementById('total-training-minutes').value = selectedPlayerData['Total Training Minutes'] || 0;
				document.getElementById('total-matches').value = selectedPlayerData['Total Matches'] || 0;
				document.getElementById('matches-played').value = selectedPlayerData['Matches Played'] || 0;
				document.getElementById('total-match-minutes').value = selectedPlayerData['Total Match Minutes'] || 0;
				document.getElementById('match-minutes-played').value = selectedPlayerData['Match Minutes Played'] || 0;

				// Populate Performance Ratings
				const sliders = [
					'movement-to-receive', 'actions-to-create', 'actions-to-disrupt',
					'with-balance', 'with-speed', 'execution',
					'speed', 'aggressive', 'dominant',
					'communication', 'demanding', 'confidence'
				];
				ratingsLoadedFromFile = false; // Reset the flag
				ratingsManuallyChanged.clear(); // Reset manual changes
				let hasRatings = false;
				sliders.forEach(id => {
					const slider = document.getElementById(id);
					const label = id.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
					const value = selectedPlayerData[label] || 3;
					slider.value = value;
					document.getElementById(`${id}-value`).textContent = value;
					if (selectedPlayerData[label] !== undefined) {
						hasRatings = true; // At least one rating is provided in the file
					}
				});
				if (hasRatings) {
					ratingsLoadedFromFile = true; // Set the flag if ratings were loaded
				}

				// Populate Grades
				document.getElementById('current-grade').value = selectedPlayerData['Current Grade'] || 'A';
				document.getElementById('target-grade').value = selectedPlayerData['Target Grade'] || 'A';

				// Populate Feedback
				document.getElementById('targeted-feedback').value = selectedPlayerData['Targeted Feedback'] || '';
				document.getElementById('areas-improvement').value = selectedPlayerData['Areas of Improvement'] || '';

				// Populate Signatures
				document.getElementById('coach1-name').value = selectedPlayerData['Coach 1 Name'] || 'Melvin Chow';
				document.getElementById('coach1-title').value = selectedPlayerData['Coach 1 Title'] || 'Coach';
				document.getElementById('coach2-name').value = selectedPlayerData['Coach 2 Name'] || 'Lee Hong Lim';
				document.getElementById('coach2-title').value = selectedPlayerData['Coach 2 Title'] || 'Coach';
				document.getElementById('technical-director').value = selectedPlayerData['Technical Director'] || 'Darren Bowman';
				document.getElementById('technical-director-title').value = selectedPlayerData['Technical Director Title'] || 'Technical Director';

				updateGenerateButtonState();
				// Add a slight delay to ensure the DOM is updated before calling updateProgress
				setTimeout(() => {
					updateProgress();
				}, 0);
			} else {
				// Reset form if no player is selected
				resetForm();
			}
		});
			
			// Sliders
			sliders.forEach(id => {
				const slider = document.getElementById(id);
				slider.addEventListener('input', () => {
					document.getElementById(`${id}-value`).textContent = slider.value;
					ratingsManuallyChanged.add(id); // Track that this slider was manually changed
					updateProgress();
				});
			});

			// Height and attendance inputs
			// Removed duplicate event listeners for height dropdowns (they were added twice)
			document.getElementById('height-start-month').addEventListener('change', populateHeightInputs);
			document.getElementById('height-end-month').addEventListener('change', populateHeightInputs);
			document.getElementById('height-year').addEventListener('change', populateHeightInputs);

			document.querySelectorAll('#attendance-manual-input input[type="number"]').forEach(input => {
				input.addEventListener('input', updateProgress);
			});

			// Feedback and signatures
			document.getElementById('current-grade').addEventListener('change', updateProgress);
			document.getElementById('target-grade').addEventListener('change', updateProgress);
			document.getElementById('targeted-feedback').addEventListener('input', updateProgress);
			document.getElementById('areas-improvement').addEventListener('input', updateProgress);
			document.getElementById('coach1-name').addEventListener('input', updateProgress);
			document.getElementById('coach2-name').addEventListener('input', updateProgress);
			document.getElementById('technical-director').addEventListener('input', updateProgress);

			// Buttons
			generateBtn.addEventListener('click', generateReport);
			resetBtn.addEventListener('click', resetForm);
			printBtn.addEventListener('click', preparePrintView);
			document.getElementById('download-session-btn').addEventListener('click', downloadAllSessionData);

			// Saved reports interaction
			document.addEventListener('click', (e) => {
				if (e.target.matches('button[onclick^="viewSavedReport"]')) {
					const index = parseInt(e.target.getAttribute('onclick').match(/\d+/)[0]);
					viewSavedReport(index);
				} else if (e.target.matches('button[onclick^="deleteSavedReport"]')) {
					const index = parseInt(e.target.getAttribute('onclick').match(/\d+/)[0]);
					deleteSavedReport(index);
				}
			});

			// Beforeunload handling
			const originalGenerateReport = generateReport;
			generateReport = function() {
				originalGenerateReport();
				updateBeforeUnloadListener();
			};
			const originalDownloadAllSessionData = downloadAllSessionData;
			downloadAllSessionData = function() {
				originalDownloadAllSessionData();
				updateBeforeUnloadListener();
			};
			const originalUpdateSavedReportsList = updateSavedReportsList;
			updateSavedReportsList = function() {
				originalUpdateSavedReportsList();
				updateBeforeUnloadListener();
			};
			updateBeforeUnloadListener();

			// Initial setup
			togglePlayerInput();
			populateYears(); // Moved before populateHeightInputs to ensure the year dropdown is populated
			populateHeightInputs(); // Now called after populateYears to ensure valid year values
			updateGenerateButtonState();
			updateProgress();
		});
			
	</script>
	<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'925c0a02f8251fc2',t:'MTc0Mjg4MDg2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
	</script>
	</html>